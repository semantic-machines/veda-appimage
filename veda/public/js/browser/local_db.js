// Local client database module
'use strict';System.register(["../common/veda.js"],function(a){"use strict";/**
 * Local database singleton constructor
 * @return {Promise} database instance promise
 */function b(){// Singleton pattern
return this.veda_version=c.manifest.veda_version,this.db_name=c.manifest.short_name,this.store_name="store",b.prototype[this.db_name+this.store_name]?Promise.resolve(b.prototype[this.db_name+this.store_name]):b.prototype[this.db_name+this.store_name]=this.initDB()}var c,d,e;return{setters:[function(a){c=a.default}],execute:function(){d={get:function get(a){return Promise.resolve(this[a])},put:function put(a,b){return this[a]=b,Promise.resolve(b)},remove:function remove(a){var b=delete this[a];return Promise.resolve(b)}},a("default",b);/**
 * Initialize database instance
 * @return {Promise} database instance promise
 */e=b.prototype,e.initDB=function(){var a=this;return new Promise(function(b,c){var d=window.indexedDB.open(a.db_name,a.veda_version);d.onsuccess=function(c){var d=c.target.result;a.db=d,console.log("DB open success, veda_version = ".concat(a.veda_version)),b(a)},d.onerror=function(a){console.log("DB open error",a),c(a)},d.onblocked=function(){alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0437\u0430\u043A\u0440\u043E\u0439\u0442\u0435 \u0434\u0440\u0443\u0433\u0438\u0435 \u043E\u0442\u043A\u0440\u044B\u0442\u044B\u0435 \u0432\u043A\u043B\u0430\u0434\u043A\u0438 \u0441\u0438\u0441\u0442\u0435\u043C\u044B! \nPlease close all other open tabs with the system!")},d.onupgradeneeded=function(b){var c=b.target.result;c.objectStoreNames.contains(a.store_name)&&(c.deleteObjectStore(a.store_name),console.log("DB store deleted: ".concat(a.store_name))),c.createObjectStore(a.store_name),console.log("DB create success: ".concat(a.store_name,", veda_version = ").concat(a.veda_version))}})["catch"](function(a){return console.log("IndexedDB error, using in-memory fallback.",a),d})},e.get=function(a){var b=this;return new Promise(function(c,d){var e=b.db.transaction([b.store_name],"readonly").objectStore(b.store_name).get(a);e.onerror=d,e.onsuccess=function(a){return c(a.target.result)}})},e.put=function(a,b){var c=this;return new Promise(function(d,e){var f=c.db.transaction([c.store_name],"readwrite").objectStore(c.store_name).put(b,a);f.onerror=e,f.onsuccess=function(){return d(b)}})},e.remove=function(a){var b=this;return new Promise(function(c,d){var e=b.db.transaction([b.store_name],"readwrite").objectStore(b.store_name)["delete"](a);e.onerror=d,e.onsuccess=function(a){return c(a.target.result)}})}}}});
//# sourceMappingURL=local_db.js.map