{"version":3,"sources":["../../../source-web/js/browser/individual_presenter.js"],"names":["IndividualPresenter","container","template","mode","extra","toAppend","$","reg_file","load","then","individual","offlineTemplate","IndividualModel","test","templateString","HTMLElement","outerHTML","renderTemplate","hasValue","toString","veda","Backend","loadFile","templatePromise","isClass","Error","ontology","typePromises","map","type","Promise","all","types","templatesPromises","defaultTemplateUri","getClassTemplate","id","templates","renderedTemplatesPromises","renderedTemplates","reduce","acc","renderedTemplate","add","catch","error","console","log","trim","match","pre_render_src","pre_result","post_render_src","eval","resolve","processTemplate","processedTemplate","trigger","append","resetHandler","parent","embedded","item","data","push","uris","Util","unique","p","reset","errorHandler","saveHandler","isSync","individuals_properties","properties","filter","Boolean","props","put_individuals","ticket","forEach","isNew","isLoaded","successHandler","deleteHandler","delete","recoverHandler","recover","removeHandler","remove","removedAlert","empty","successMsg","notify","Notify","name","errorMsg","specs","extend","apply","concat","_class","getClassSpecifications","attr","join","view","find","addBack","edit","search","_view","_edit","_search","modeHandler","event","stopPropagation","show","hide","on","syncEmbedded","one","removeData","e","deletedHandler","prop","hasClass","alertModel","recoverModel","canUpdate","arr","alert","formatValue","deletedAlert","click","prepend","addClass","removeClass","off","call","validHandler","loaded","invalidAlert","i","el","self","str","replace","style","title","titleIndividual","about","isAbout","propertyContainer","property_uri","about_uri","idModifiedHandler","text","propertyModifiedHandler","renderPropertyValues","get","$this","target","resource_uri","closest","resource","relContainer","countDisplayed","children","length","rel_uri","rels","relTemplate","isEmbedded","spec","rel_inline_template","html","rel_template_uri","limit","more","sortable","delay","placeholder","forcePlaceholderSize","handle","cancel","update","attribute","set","uri","property","valueType","emptyValue","values","limit_param","value","renderRelationValue","embeddedHandler","abouts","aboutTemplate","aboutContainer","about_template_uri","about_inline_template","present","validation","state","validateTemplate","Object","keys","validate","embeddedTemplate","embeddedValidation","triggerValidation","mergeValidationResult","validationResult","not","control","controlType","fn","cause","validatedHandler","popover","explanation","message","causesPromises","cause_uri","causes","content","placement","animation","is","assignDefaultValue","opts","promises","formattedValue","prevValue","valueHolder","btnGroup","btnRemove","removeValue","mouseenter","mouseleave","valTemplate","index","indexOf","splice","btnDrag","preventDefault","mousedown","mouseup","css","cell","last","result","minCardinalityState","maxCardinalityState","regexp","RegExp","regexpState","minValueState","maxValueState","minLengthState","maxLengthState","riot","prototype"],"mappings":"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","sourcesContent":["// Individual Presenter\n\n'use strict';\n\nimport veda from '../common/veda.js';\n\nimport IndividualModel from '../common/individual_model.js';\n\nimport Backend from '../common/backend.js';\n\nimport Util from '../common/util.js';\n\nimport '../browser/util.js';\n\nimport riot from '../common/lib/riot.js';\n\nimport Notify from '../browser/notify.js';\n\nimport '../browser/veda_controls.js';\n\nimport $ from 'jquery';\n\nimport 'jquery-ui';\n\nimport 'tablesortable';\n\nIndividualModel.prototype.present = IndividualPresenter;\n\nexport default IndividualPresenter;\n\n/**\n * Individual presenter method for IndividualModel class\n * @param {Element} container - container to render individual to\n * @param {IndividualModel|string} template - template to render individual with\n * @param {string} mode - view | edit | search\n * @param {Object} extra - extra parameters to pass ro template\n * @param {Boolean} toAppend - flag defining either to append or replace the container's content with rendered template\n * @return {Promise}\n */\nfunction IndividualPresenter (container, template, mode, extra, toAppend) {\n  mode = mode || 'view';\n\n  toAppend = typeof toAppend !== 'undefined' ? toAppend : true;\n\n  if (typeof container === 'string') {\n    container = $(container);\n  }\n\n  const reg_uri = /^[a-z][a-z-0-9]*:([a-zA-Z0-9-_])*$/;\n  const reg_file = /\\.html$/;\n\n  return this.load()\n    .then(function (individual) {\n      const offlineTemplate = '<h5 class=\\'container sheet text-center text-muted\\'>Нет связи с сервером. Этот объект сейчас недоступен / Server disconnected. This object is not available now</h5>';\n\n      if (template) {\n        if (template instanceof IndividualModel) {\n        // if template is uri\n        } else if (typeof template === 'string' && reg_uri.test(template) ) {\n          template = new IndividualModel(template);\n        } else {\n          let templateString;\n          if (typeof template === 'string') {\n            templateString = template;\n          } else if (template instanceof HTMLElement) {\n            templateString = template.outerHTML;\n          }\n          return renderTemplate(individual, container, templateString, mode, extra, toAppend);\n        }\n        return template.load().then(function (template) {\n          const templateString = template.hasValue('v-ui:template') ? template['v-ui:template'][0].toString() : offlineTemplate;\n          if (reg_file.test(templateString)) {\n            return veda.Backend.loadFile('/templates/' + templateString).then(function (templateString) {\n              return renderTemplate(individual, container, templateString, mode, extra, toAppend);\n            });\n          } else {\n            return renderTemplate(individual, container, templateString, mode, extra, toAppend);\n          }\n        });\n      } else {\n        const isClass = individual.hasValue('rdf:type', 'owl:Class') || individual.hasValue('rdf:type', 'rdfs:Class');\n        let templatePromise;\n        if ( individual.hasValue('v-ui:hasTemplate') && !isClass ) {\n          template = individual['v-ui:hasTemplate'][0];\n          templatePromise = template.load().then(function (template) {\n            if ( !template.hasValue('rdf:type', 'v-ui:ClassTemplate') ) {\n              throw new Error('Template type violation!');\n            }\n            const templateString = template.hasValue('v-ui:template') ? template['v-ui:template'][0].toString() : offlineTemplate;\n            if (reg_file.test(templateString)) {\n              return veda.Backend.loadFile('/templates/' + templateString).then(function (templateString) {\n                return renderTemplate(individual, container, templateString, mode, extra, toAppend);\n              });\n            } else {\n              return renderTemplate(individual, container, templateString, mode, extra, toAppend);\n            }\n          });\n        } else {\n          const ontology = veda.ontology;\n\n          const typePromises = individual['rdf:type'].map(function (type) {\n            return type.load();\n          });\n          templatePromise = Promise.all(typePromises).then(function (types) {\n            const templatesPromises = types.map( function (type) {\n              const defaultTemplateUri = ontology.getClassTemplate(type.id);\n              if (defaultTemplateUri) {\n                return new IndividualModel(defaultTemplateUri).load();\n              } else {\n                return type.hasValue('v-ui:hasTemplate') ? type['v-ui:hasTemplate'][0].load() : new IndividualModel('v-ui:generic').load();\n              }\n            });\n            return Promise.all(templatesPromises);\n          }).then(function (templates) {\n            const renderedTemplatesPromises = templates.map( function (template) {\n              const templateString = template.hasValue('v-ui:template') ? template['v-ui:template'][0].toString() : offlineTemplate;\n              if (reg_file.test(templateString)) {\n                return veda.Backend.loadFile('/templates/' + templateString).then(function (templateString) {\n                  return renderTemplate(individual, container, templateString, mode, extra, toAppend);\n                });\n              } else {\n                return renderTemplate(individual, container, templateString, mode, extra, toAppend);\n              }\n            });\n            return Promise.all(renderedTemplatesPromises);\n          }).then(function (renderedTemplates) {\n            return renderedTemplates.reduce(function (acc, renderedTemplate) {\n              return acc.add(renderedTemplate);\n            }, $());\n          });\n        }\n        return templatePromise;\n      }\n    })\n    .catch(function (error) {\n      console.log('Presenter error', error);\n    });\n}\n\n/**\n * Render template\n * @param {IndividualModel} individual - individual to render\n * @param {Element} container - container to render individual to\n * @param {IndividualModel|string} template - template to render individual with\n * @param {string} mode - view | edit | search\n * @param {Object} extra - extra parameters to pass ro template\n * @param {Boolean} toAppend - flag defining either to append or replace the container's content with rendered template\n * @return {Promise}\n */\nfunction renderTemplate (individual, container, template, mode, extra, toAppend) {\n  template = template.trim();\n\n  // Extract pre script, template and post script\n  const match = template.match(/^(?:<script[^>]*>([\\s\\S]*?)<\\/script>)?([\\s\\S]*?)(?:<script[^>]*>(?![\\s\\S]*<script[^>]*>)([\\s\\S]*)<\\/script>)?$/i);\n  const pre_render_src = match[1];\n  template = $( match[2] );\n  const post_render_src = match[3];\n\n  let pre_result;\n  if (pre_render_src) {\n    pre_result = eval('(function (){ \\'use strict\\'; ' + pre_render_src + '}).call(individual);');\n  }\n\n  return (pre_result instanceof Promise ? pre_result : Promise.resolve(pre_result)).then(function () {\n    return processTemplate(individual, container, template, mode).then(function (processedTemplate) {\n      processedTemplate.trigger(mode);\n\n      if (toAppend) {\n        container.append(processedTemplate);\n      }\n\n      if (post_render_src) {\n        eval('(function (){ \\'use strict\\'; ' + post_render_src + '}).call(individual);');\n      }\n      return processedTemplate;\n    });\n  });\n}\n\n/**\n * Process template\n * @param {IndividualModel} individual - individual to render\n * @param {Element} container - container to render individual to\n * @param {Element} template - template to render individual with\n * @param {string} mode - view | edit | search\n * @this Individual\n * @return {Promise}\n */\nfunction processTemplate (individual, container, template, mode) {\n  // Get properties specifications\n  const ontology = veda.ontology;\n  const specs = $.extend.apply(\n    {}, [{}].concat(\n      individual['rdf:type'].map( function (_class) {\n        return ontology.getClassSpecifications(_class.id);\n      }),\n    ),\n  );\n  template.attr({\n    'resource': individual.id,\n    'typeof': individual['rdf:type'].map(function (item) {\n      return item.id;\n    }).join(' '),\n  });\n\n  const view = template.find('.view').addBack('.view');\n  const edit = template.find('.edit').addBack('.edit');\n  const search = template.find('.search').addBack('.search');\n  const _view = template.find('.-view').addBack('.-view');\n  const _edit = template.find('.-edit').addBack('.-edit');\n  const _search = template.find('.-search').addBack('.-search');\n\n  /**\n   * Template mode handler. Applies mode to template to show/hide elements in different modes\n   * @param {Event} event\n   * @return {void}\n   */\n  const modeHandler = function (event) {\n    event.stopPropagation();\n    mode = event.type;\n    template.data('mode', mode);\n    switch (mode) {\n    case 'view': view.show(); _view.hide(); break;\n    case 'edit': edit.show(); _edit.hide(); break;\n    case 'search': search.show(); _search.hide(); break;\n    }\n  };\n  template.on('view edit search', modeHandler);\n\n  // Embedded templates list\n  const embedded = [];\n\n  /**\n   * Template mode handler. Triggers same events for embedded templates\n   * @param {Event} event\n   * @return {void}\n   */\n  const syncEmbedded = function (event) {\n    embedded.map(function (item) {\n      item.trigger(event.type, individual.id);\n    });\n    event.stopPropagation();\n  };\n  template.on('view edit search', syncEmbedded);\n\n  // Define handlers\n\n  template.data({\n    'reset': resetHandler,\n    'save': saveHandler,\n    'delete': deleteHandler,\n    'recover': recoverHandler,\n    'remove': removeHandler,\n  });\n  template.one('remove', function () {\n    template.removeData('reset', 'save', 'delete', 'recover', 'remove');\n  });\n  template.on('cancel save delete recover destroy', function (e) {\n    e.stopPropagation();\n    if (e.type === 'cancel') {\n      resetHandler();\n    } else if (e.type === 'save') {\n      saveHandler();\n    } else if (e.type === 'delete') {\n      deleteHandler();\n    } else if (e.type === 'recover') {\n      recoverHandler();\n    } else if (e.type === 'destroy') {\n      removeHandler();\n    }\n  });\n\n  /**\n   * Reset individual and embedded individuals\n   * @param {string} parent id\n   * @param {Array} acc for individuals uris\n   * @return {Promise<void>}\n   */\n  function resetHandler (parent, acc) {\n    acc = acc || [];\n    acc = embedded.reduce((acc, item) => item.data('reset')(individual.id, acc), acc);\n    acc.push(individual.id);\n    if (parent) {\n      return acc;\n    }\n    const uris = Util.unique(acc);\n    return uris.reduce((p, item) => p.then(() => new veda.IndividualModel(item).reset(true)), Promise.resolve())\n      .then(() => template.trigger('view'))\n      .catch(errorHandler);\n  }\n\n  /**\n   * Save individual and embedded children individuals\n   * @param {string} parent id\n   * @param {Array} acc for individuals uris\n   * @return {Promise<void>}\n   */\n  function saveHandler (parent, acc) {\n    acc = acc || [];\n    acc = embedded.reduce((acc, item) => item.data('save')(individual.id, acc), acc);\n    if (parent !== individual.id) {\n      acc.push(individual.id);\n    }\n    if (parent) {\n      return acc;\n    }\n    individual.isSync(false);\n    const uris = Util.unique(acc);\n    const individuals_properties = uris.map((item) => {\n      const individual = new veda.IndividualModel(item);\n      if (!individual.isSync()) {\n        return individual.properties;\n      }\n    }).filter(Boolean);\n    return Promise.all(individuals_properties.map((props) => new veda.IndividualModel(props['@']).trigger('beforeSave')))\n      .then(() => Backend.put_individuals(veda.ticket, individuals_properties))\n      .then(() => {\n        individuals_properties.forEach((props) => {\n          const individual = new veda.IndividualModel(props['@']);\n          individual.isNew(false);\n          individual.isSync(true);\n          individual.isLoaded(true);\n        });\n      })\n      .then(() => Promise.all(individuals_properties.map((props) => new veda.IndividualModel(props['@']).trigger('afterSave'))))\n      .then(() => template.trigger('view'))\n      .then(() => successHandler())\n      .catch(errorHandler);\n  }\n\n  /**\n   * Delete individual and embedded children individuals\n   * @param {string} parent id\n   * @return {Promise<void>}\n   */\n  function deleteHandler () {\n    return individual.delete()\n      .then(() => {\n        template.trigger('view');\n        successHandler();\n      })\n      .catch(errorHandler);\n  }\n\n  /**\n   * Recover individual and embedded children individuals\n   * @param {string} parent id\n   * @return {Promise<void>}\n   */\n  function recoverHandler () {\n    return individual.recover()\n      .then(() => {\n        template.trigger('view');\n        successHandler();\n      })\n      .catch(errorHandler);\n  }\n\n  /**\n   * Remove individual and embedded children individuals\n   * @param {string} parent id\n   * @param {Array} acc for individuals uris\n   * @return {Promise<void>}\n   */\n  function removeHandler (parent, acc) {\n    acc = acc || [];\n    acc = embedded.reduce((acc, item) => item.data('remove')(individual.id, acc), acc);\n    acc.push(individual.id);\n    if (parent) {\n      return acc;\n    }\n    const uris = Util.unique(acc);\n    return uris.reduce((p, item) => p.then(() => new veda.IndividualModel(item).remove()), Promise.resolve())\n      .then(successHandler)\n      .then(() => {\n        const removedAlert = new IndividualModel('v-s:RemovedAlert');\n        removedAlert.load().then(function (removedAlert) {\n          template.empty().append(`<p class=\"bg-danger\"><strong>${removedAlert.toString()}</strong></p>`);\n        });\n      })\n      .catch(errorHandler);\n  }\n\n  /**\n   * Show success message\n   * @return {void}\n   */\n  function successHandler () {\n    const successMsg = new IndividualModel('v-s:SuccessBundle').load();\n    successMsg.then((successMsg) => {\n      const notify = Notify ? new Notify() : function () {};\n      notify('success', {name: successMsg.toString()});\n    }).catch(console.log);\n  }\n\n  /**\n   * Show error message\n   * @param {Error} error to handle\n   * @throw {Error}\n   */\n  function errorHandler (error) {\n    const errorMsg = new IndividualModel('v-s:ErrorBundle').load();\n    errorMsg.then((errorMsg) => {\n      const notify = Notify ? new Notify() : function () {};\n      notify('danger', {name: errorMsg.toString()});\n    }).catch(console.log);\n    throw error;\n  }\n\n  /**\n   * Individual v-s:deleted handler. Shows deleted alert.\n   * @this Individual\n   * @return {void}\n   */\n  const deletedHandler = function () {\n    if ( this.hasValue('v-s:deleted', true) ) {\n      if ( container && typeof container.prop === 'function' && container.prop('id') === 'main' && !template.hasClass('deleted') ) {\n        const alertModel = new IndividualModel('v-s:DeletedAlert');\n        const recoverModel = new IndividualModel('v-s:Recover');\n        Promise.all([alertModel.load(), recoverModel.load(), this.canUpdate()]).then(function (arr) {\n          let alert = arr[0]['rdfs:label'].map(Util.formatValue).join(' ');\n          const recover = arr[1]['rdfs:label'].map(Util.formatValue).join(' ');\n          const canUpdate = arr[2];\n          if (canUpdate) {\n            alert = alert + '<button id=\"deleted-alert-recover\" class=\"btn btn-primary btn-xs recover pull-right\">' + recover + '</button>';\n          }\n          const deletedAlert = $(\n            `<div id=\"deleted-alert\" class=\"container sheet margin-lg\">\n              <div class=\"alert alert-warning no-margin clearfix\" role=\"alert\">\n                <p id=\"deleted-alert-msg\">${alert}</p>\n              </div>\n            </div>`,\n          );\n          $('.recover', deletedAlert).click(function () {\n            template.trigger('recover');\n          });\n          template.prepend(deletedAlert);\n        });\n      }\n      if (mode !== 'search') {\n        template.addClass('deleted');\n      }\n    } else {\n      template.removeClass('deleted');\n      if ( container && typeof container.prop === 'function' && container.prop('id') === 'main' ) {\n        $('#deleted-alert', template).remove();\n      }\n    }\n  };\n  individual.on('v-s:deleted', deletedHandler);\n  template.one('remove', function () {\n    individual.off('v-s:deleted', deletedHandler);\n  });\n  deletedHandler.call(individual);\n\n  /**\n   * Individual v-s:valid handler. Shows alert whenb individual is invalid .\n   * @this Individual\n   * @return {void}\n   */\n  const validHandler = function () {\n    if ( this.hasValue('v-s:valid', false) && !this.hasValue('v-s:deleted', true) && mode === 'view' ) {\n      if ( (container.prop('id') === 'main' || container.hasClass('modal-body') ) && !template.hasClass('invalid') ) {\n        new IndividualModel('v-s:InvalidAlert').load().then(function (loaded) {\n          const alert = loaded['rdfs:label'].map(Util.formatValue).join(' ');\n          const invalidAlert = $(\n            `<div id=\"invalid-alert\" class=\"container sheet margin-lg\">\n              <div class=\"alert alert-danger no-margin clearfix\" role=\"alert\">\n                <p id=\"invalid-alert-msg\">${alert}</p>\n              </div>\n            </div>`,\n          );\n          template.prepend(invalidAlert);\n        });\n      }\n      template.addClass('invalid');\n    } else {\n      template.removeClass('invalid');\n      if ( container.prop('id') === 'main' ) {\n        $('#invalid-alert', template).remove();\n      }\n    }\n  };\n  individual.on('v-s:valid', validHandler);\n  individual.on('v-s:deleted', validHandler);\n  template.one('remove', function () {\n    individual.off('v-s:valid', validHandler);\n    individual.off('v-s:deleted', validHandler);\n  });\n  validHandler.call(individual);\n\n  // Process RDFa compliant template\n\n  // Special (not RDFa)\n  template.find('[href*=\\'@\\']:not([rel] *):not([about] *)').addBack('[href*=\\'@\\']:not([rel] *):not([about] *)').map( function (i, el) {\n    const self = $(el);\n    const str = self.attr('href');\n    self.attr('href', str.replace('@', individual.id));\n  });\n\n  template.find('[src*=\\'@\\']:not([rel] *):not([about] *)').addBack('[src*=\\'@\\']:not([rel] *):not([about] *)').map( function (i, el) {\n    const self = $(el);\n    const str = self.attr('src');\n    self.attr('src', str.replace('@', individual.id));\n  });\n\n  template.find('[style*=\\'@\\']:not([rel] *):not([about] *)').addBack('[style*=\\'@\\']:not([rel] *):not([about] *)').map( function (i, el) {\n    const self = $(el);\n    const style = self.attr('style');\n    self.attr('style', style.replace('@', individual.id));\n  });\n\n  template.find('[title]:not([rel] *):not([about] *)').addBack('[style*=\\'@\\']:not([rel] *):not([about] *)').map( function (i, el) {\n    const self = $(el);\n    const title = self.attr('title');\n    if ( (/^(\\w|-)+:.*?$/).test(title) ) {\n      const titleIndividual = new IndividualModel(title);\n      titleIndividual.load().then(function (titleIndividual) {\n        self.attr('title', titleIndividual);\n      });\n    }\n  });\n\n  // Property values\n  const props = template.find('[property]:not(veda-control):not([rel] *):not([about] *)').addBack('[property]:not(veda-control):not([rel] *):not([about] *)').map( function (i, el) {\n    const propertyContainer = $(el);\n    const property_uri = propertyContainer.attr('property');\n    const about_uri = propertyContainer.attr('about');\n    let about;\n    let isAbout;\n\n    if (about_uri === '@') {\n      about = individual;\n      isAbout = true;\n      propertyContainer.attr('about', about.id);\n    } else if (!about_uri) {\n      about = individual;\n      isAbout = false;\n    } else {\n      about = new IndividualModel(about_uri);\n      isAbout = true;\n    }\n\n    return about.load().then(function (about) {\n      const idModifiedHandler = function () {\n        propertyContainer.text(about.id);\n      };\n      if (property_uri === '@') {\n        propertyContainer.text(about.id);\n        about.on('idChanged', idModifiedHandler);\n        template.one('remove', function () {\n          about.off('idChanged', idModifiedHandler);\n        });\n        return;\n      }\n\n      // Re-render all property values if model's property was changed\n      const propertyModifiedHandler = function () {\n        renderPropertyValues(about, isAbout, property_uri, propertyContainer, template, mode);\n      };\n      about.on(property_uri, propertyModifiedHandler);\n      template.one('remove', function () {\n        about.off(property_uri, propertyModifiedHandler);\n      });\n\n      renderPropertyValues(about, isAbout, property_uri, propertyContainer, template, mode);\n    });\n  }).get();\n\n  // Max displayed values\n  template.on('click', '.more', function (event) {\n    event.stopPropagation();\n    const $this = $(event.target);\n    const resource_uri = $this.closest('[resource]').attr('resource');\n    const resource = new IndividualModel(resource_uri);\n    const relContainer = $this.closest('[rel]');\n    const countDisplayed = relContainer.children().length - 1;// last children is .more button\n    const rel_uri = relContainer.attr('rel');\n\n    resource.trigger(rel_uri, resource.get(rel_uri), countDisplayed + 10);\n    $this.remove();\n  });\n\n  // Related resources & about resources\n  const rels = template.find('[rel]:not(veda-control):not([rel] *):not([about] *)').addBack('[rel]:not(veda-control):not([rel] *):not([about] *)').map( function (i, el) {\n    const relContainer = $(el);\n    let about = relContainer.attr('about');\n    const rel_uri = relContainer.attr('rel');\n    const isEmbedded = relContainer.attr('data-embedded') === 'true';\n    const spec = specs[rel_uri] ? new IndividualModel( specs[rel_uri] ) : undefined;\n    const rel_inline_template = relContainer.html().trim();\n    const rel_template_uri = relContainer.attr('data-template');\n    let limit = relContainer.attr('data-limit') || Infinity;\n    const more = relContainer.attr('data-more') || false;\n    let relTemplate;\n    let isAbout;\n\n    const sortableOptions = {\n      delay: 150,\n      placeholder: 'sortable-placeholder',\n      forcePlaceholderSize: true,\n      handle: '.button-drag',\n      cancel: '',\n      update: function () {\n        const uris = $(this).sortable('toArray', {attribute: 'resource'});\n        individual.set(\n          rel_uri,\n          uris.map(function (uri) {\n            return new IndividualModel(uri);\n          }),\n        );\n      },\n    };\n    relContainer.sortable(sortableOptions);\n    template.one('remove', function () {\n      relContainer.sortable('destroy');\n    });\n\n    if (about) {\n      isAbout = true;\n      about = (about === '@' ? individual : new IndividualModel(about));\n      relContainer.attr('about', about.id);\n    } else {\n      isAbout = false;\n      about = individual;\n    }\n\n    if ( rel_template_uri ) {\n      relTemplate = rel_template_uri;\n    } else if ( rel_inline_template.length ) {\n      relTemplate = rel_inline_template;\n    }\n    relContainer.empty();\n\n    template.on('view edit search', function (e) {\n      if (e.type === 'view') {\n        relContainer.sortable('disable');\n      } else if (e.type === 'edit') {\n        relContainer.sortable('enable');\n        const property = new IndividualModel(rel_uri);\n        if ( isEmbedded &&\n            spec &&\n            spec['v-ui:minCardinality'][0] >= 1 &&\n            !individual.hasValue(rel_uri) &&\n            !(property.hasValue('rdfs:range') && property['rdfs:range'][0].id === 'v-s:File')\n        ) {\n          const valueType = spec && spec.hasValue('v-ui:rangeRestriction') ?\n            spec['v-ui:rangeRestriction'] : property.hasValue('rdfs:range') ?\n              property['rdfs:range'] : [];\n          const emptyValue = new IndividualModel();\n          if ( valueType.length ) {\n            emptyValue['rdf:type'] = valueType;\n          }\n          individual.set(rel_uri, [emptyValue]);\n        }\n      } else if (e.type === 'search') {\n        relContainer.sortable('enable');\n      }\n      e.stopPropagation();\n    });\n\n    return about.load().then(function (about) {\n      const values = about.get(rel_uri);\n\n      const propertyModifiedHandler = function (values, limit_param) {\n        limit = limit_param || limit;\n        relContainer.empty();\n\n        return values.reduce((p, value, i) => {\n          return p.then((templates) => {\n            if (i < limit) {\n              return renderRelationValue(about, isAbout, rel_uri, value, relContainer, relTemplate, template, mode, embedded, isEmbedded, false)\n                .then((template) => templates.concat(template));\n            } else {\n              return templates;\n            }\n          });\n        }, Promise.resolve([]))\n          .then((templates) => {\n            relContainer.append(templates);\n            if (limit < values.length && more) {\n              relContainer.append( '<a class=\\'more badge\\'>&darr; ' + (values.length - limit) + '</a>' );\n            }\n          });\n      };\n\n      const embeddedHandler = function (values) {\n        if (mode === 'edit') {\n          values.map(function (value) {\n            if (\n              value.id !== about.id && // prevent self parent\n              rel_uri !== 'v-s:parent' && // prevent circular parent\n              !value.hasValue('v-s:parent') // do not change parent\n            ) {\n              value['v-s:parent'] = [about];\n              value['v-s:backwardTarget'] = [about];\n              value['v-s:backwardProperty'] = [rel_uri];\n              value['v-s:canRead'] = [true];\n              value['v-s:canUpdate'] = [true];\n              value['v-s:canDelete'] = [true];\n            }\n          });\n        }\n      };\n\n      if (isEmbedded) {\n        embeddedHandler(values);\n        about.on(rel_uri, embeddedHandler);\n        template.one('remove', function () {\n          about.off(rel_uri, embeddedHandler);\n        });\n      }\n\n      about.on(rel_uri, propertyModifiedHandler);\n      template.one('remove', function () {\n        about.off(rel_uri, propertyModifiedHandler);\n      });\n\n      return propertyModifiedHandler(values, limit);\n    });\n  }).get();\n\n  // About resource\n  const abouts = template.find('[about]:not([rel] *):not([about] *):not([rel]):not([property])').addBack('[about]:not([rel] *):not([about] *):not([rel]):not([property])').map( function (i, el) {\n    const aboutContainer = $(el);\n    const about_template_uri = aboutContainer.attr('data-template');\n    const about_inline_template = aboutContainer.html().trim();\n    const isEmbedded = aboutContainer.attr('data-embedded') === 'true';\n    let about; let aboutTemplate;\n    if ( about_template_uri ) {\n      aboutTemplate = new IndividualModel( about_template_uri );\n    } else if ( about_inline_template.length ) {\n      aboutTemplate = about_inline_template;\n    }\n    aboutContainer.empty();\n    if (aboutContainer.attr('about') === '@') {\n      about = individual;\n      aboutContainer.attr('about', about.id);\n    } else {\n      about = new IndividualModel(aboutContainer.attr('about'));\n    }\n    return about.present(aboutContainer, aboutTemplate, isEmbedded ? mode : undefined).then(function (aboutTemplate) {\n      if (isEmbedded) {\n        aboutTemplate.data('isEmbedded', true);\n        embedded.push(aboutTemplate);\n        if (mode === 'edit') {\n          aboutTemplate.trigger('internal-validate');\n        }\n      }\n    });\n  }).get();\n\n  // Validation with support of embedded templates (arbitrary depth)\n\n  // Initial validation state\n  const validation = {state: true};\n  template.data('validation', validation);\n\n  /**\n   * Validate template handler\n   * @param {Event} event - custom 'internal-validate' event\n   * @return {void}\n   */\n  const validateTemplate = function (event) {\n    event.stopPropagation();\n    if (mode === 'edit') {\n      Object.keys(validation).map( function (property_uri) {\n        if (property_uri === 'state') {\n          return;\n        }\n        const spec = specs[property_uri] ? new IndividualModel( specs[property_uri] ) : undefined;\n        validation[property_uri] = validate(individual, property_uri, spec);\n      });\n      template.trigger('validate');\n      validation.state = Object.keys(validation).reduce( function (acc, property_uri) {\n        if (property_uri === 'state') {\n          return acc;\n        }\n        return acc && validation[property_uri].state;\n      }, true);\n      validation.state = validation.state && embedded.reduce(function (acc, embeddedTemplate) {\n        const embeddedValidation = embeddedTemplate.data('validation');\n        return embeddedValidation ? acc && embeddedValidation.state : acc;\n      }, true);\n      template.trigger('internal-validated', [validation]);\n    }\n    // \"validate\" event should bubble up to be handled by parent template only if current template is embedded\n    if ( template.data('isEmbedded') ) {\n      container.trigger('internal-validate');\n    }\n  };\n  template.on('internal-validate', validateTemplate);\n\n  /**\n   * Trigger 'internal-validate' event on individual property change or when mode switches to 'edit'\n   * @return {void}\n   */\n  const triggerValidation = function () {\n    if (mode === 'edit') {\n      template.trigger('internal-validate');\n    }\n  };\n  individual.on('propertyModified', triggerValidation);\n\n  template.one('remove', function () {\n    individual.off('propertyModified', triggerValidation);\n  });\n  template.on('edit', triggerValidation);\n\n  /**\n   * Merge validation result from custom template validation\n   * @param {Event} event - custom 'validated' event\n   * @param {Object} validationResult - validation result object\n   * @return {void}\n   */\n  const mergeValidationResult = function (event, validationResult) {\n    event.stopPropagation();\n    if (mode === 'edit') {\n      Object.keys(validationResult).map(function (property_uri) {\n        if (property_uri === 'state') {\n          return;\n        }\n        validation[property_uri] = validationResult[property_uri];\n      });\n      validation.state = Object.keys(validation).reduce( function (acc, property_uri) {\n        if (property_uri === 'state') {\n          return acc;\n        }\n        return acc && validation[property_uri].state;\n      }, true);\n      template.trigger('internal-validated', [validation]);\n    }\n  };\n\n  // Handle validation events from template\n  template.on('validate', (e) => e.stopPropagation());\n  template.on('validated', mergeValidationResult);\n\n  // Controls\n  template.find('veda-control[property], veda-control[rel]').not('[rel] *').not('[about] *').map( function (i, el) {\n    const control = $(el);\n    const property_uri = control.attr('property') || control.attr('rel');\n    const type = control.attr('data-type') || 'generic';\n    const spec = specs[property_uri] ? new IndividualModel( specs[property_uri] ) : undefined;\n    const controlType = $.fn['veda_' + type];\n\n    // control.removeAttr(\"property\").removeAttr(\"rel\");\n\n    // Initial validation state\n    validation[property_uri] = {state: true, cause: []};\n\n    const validatedHandler = function (e, validation) {\n      if ( validation.state || !validation[property_uri] || validation[property_uri].state === true ) {\n        control.removeClass('has-error');\n        control.popover('destroy');\n      } else {\n        control.addClass('has-error');\n        let explanation;\n        if (validation[property_uri].message) {\n          explanation = validation[property_uri].message;\n        } else {\n          const causesPromises = validation[property_uri].cause.map(function (cause_uri) {\n            return new IndividualModel(cause_uri).load();\n          });\n          Promise.all(causesPromises).then(function (causes) {\n            explanation = causes.map(function (cause) {\n              return cause['rdfs:comment'].map(Util.formatValue).filter(Boolean).join(', ');\n            }).join('\\n');\n          });\n        }\n        control.popover({\n          content: function () {\n            return explanation;\n          },\n          container: control,\n          trigger: 'hover focus',\n          placement: 'top',\n          animation: false,\n        });\n        if ( $('input', control).is(':focus') ) {\n          control.popover('show');\n        }\n      }\n      e.stopPropagation();\n    };\n    template.on('internal-validated', validatedHandler);\n\n    template.on('view edit search', function (e) {\n      e.stopPropagation();\n      control.trigger(e.type);\n    });\n\n    const assignDefaultValue = function (e) {\n      if ( spec && spec.hasValue('v-ui:defaultValue') && !individual.hasValue(property_uri) ) {\n        individual.set(property_uri, spec['v-ui:defaultValue']);\n      }\n      e.stopPropagation();\n    };\n    template.on('edit', assignDefaultValue);\n\n    const opts = {\n      individual: individual,\n      property_uri: property_uri,\n      spec: spec,\n      mode: mode,\n    };\n\n    controlType.call(control, opts);\n  });\n\n  const promises = rels.concat(abouts, props);\n  return Promise.all(promises).then(function () {\n    return template;\n  });\n}\n\n/**\n * Render literal values of individual\n * @param {IndividualModel} about - individual\n * @param {Boolean} isAbout - is about flag\n * @param {string} property_uri - which property values to render\n * @param {Element} propertyContainer - where to render values\n * @param {Element} template - template reference\n * @param {string} mode - template mode\n * @return {void}\n */\nfunction renderPropertyValues (about, isAbout, property_uri, propertyContainer, template, mode) {\n  propertyContainer.empty();\n  about.get(property_uri).map( function (value) {\n    const formattedValue = Util.formatValue(value);\n    if (isAbout) {\n      const prevValue = propertyContainer.text();\n      propertyContainer.text( prevValue ? prevValue + (formattedValue ? ' ' + formattedValue : '') : formattedValue );\n    } else {\n      const valueHolder = $('<span class=\\'value-holder\\'></span>');\n      propertyContainer.append(valueHolder.text( Util.formatValue(value) ));\n      const btnGroup = $('<div class=\\'prop-actions btn-group btn-group-xs\\' role=\\'group\\'></div>');\n      const btnRemove = $('<button class=\\'btn btn-default\\' tabindex=\\'-1\\'><span class=\\'glyphicon glyphicon-remove\\'></span></button>');\n      btnGroup.append(btnRemove);\n\n      template.on('view edit search', function (e) {\n        if (e.type === 'view') btnGroup.hide();\n        else btnGroup.show();\n        e.stopPropagation();\n      });\n      if (mode === 'view') {\n        btnGroup.hide();\n      }\n\n      btnRemove.click(function () {\n        about.removeValue( property_uri, value );\n      }).mouseenter(function () {\n        valueHolder.addClass('red-outline');\n      }).mouseleave(function () {\n        valueHolder.removeClass('red-outline');\n      });\n      valueHolder.append( btnGroup );\n    }\n  });\n}\n\n/**\n * Render related objects of individual\n * @param {IndividualModel} about - individual\n * @param {Boolean} isAbout - is about flag\n * @param {string} rel_uri - which relation values to render\n * @param {IndividualModel} value - value to render\n * @param {Element} relContainer - where to render the value\n * @param {Element} relTemplate - which template to user to render the value\n * @param {Element} template - template reference\n * @param {string} mode - template mode\n * @param {Array} embedded - embedded templates list\n * @param {Boolean} isEmbedded - flag to include rendered value to embedded list\n * @param {Boolean} toAppend - flag defining either to append or replace the relContainer's content with rendered value template\n * @return {void}\n */\nfunction renderRelationValue (about, isAbout, rel_uri, value, relContainer, relTemplate, template, mode, embedded, isEmbedded, toAppend) {\n  return value.present(relContainer, relTemplate, isEmbedded ? mode : undefined, undefined, toAppend).then(function (valTemplate) {\n    if (isEmbedded) {\n      valTemplate.data('isEmbedded', true);\n      embedded.push(valTemplate);\n      if (mode === 'edit') {\n        valTemplate.trigger('internal-validate');\n      }\n      valTemplate.one('remove', function () {\n        if (embedded.length) {\n          const index = embedded.indexOf(valTemplate);\n          if ( index >= 0 ) embedded.splice(index, 1);\n        }\n      });\n    }\n    if (!isAbout) {\n      const btnGroup = $('<div class=\\'rel-actions btn-group btn-group-xs -view edit search\\' role=\\'group\\'></div>');\n      const btnDrag = $('<button class=\\'btn btn-default button-drag\\' tabindex=\\'-1\\'><span class=\\'glyphicon glyphicon-move\\'></span></button>');\n      const btnRemove = $('<button class=\\'btn btn-default button-delete\\' tabindex=\\'-1\\'><span class=\\'glyphicon glyphicon-remove\\'></span></button>');\n      btnGroup.append(btnDrag, btnRemove);\n      template.on('view edit search', function (e) {\n        if (e.type === 'view') btnGroup.hide();\n        else btnGroup.show();\n        e.stopPropagation();\n      });\n      if (mode === 'view') {\n        btnGroup.hide();\n      }\n\n      btnRemove.click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        valTemplate.remove();\n        about.removeValue( rel_uri, value );\n        if ( value.is('v-s:Embedded') && value.hasValue('v-s:parent', about) ) {\n          value.delete();\n        }\n      }).mouseenter(function () {\n        valTemplate.addClass('red-outline');\n      }).mouseleave(function () {\n        valTemplate.removeClass('red-outline');\n      });\n\n      // Sortable scroll bugfix\n      btnDrag.mouseenter(function () {\n        valTemplate.addClass('gray-outline');\n      }).mouseleave(function () {\n        valTemplate.removeClass('gray-outline');\n      }).mousedown(function () {\n        relContainer.addClass('sortable-overflow');\n      }).mouseup(function () {\n        relContainer.removeClass('sortable-overflow');\n      });\n\n      if (valTemplate.css('display') !== 'inline') {\n        btnGroup.addClass('block');\n      }\n      if (valTemplate.css('display') === 'table-row' || valTemplate.prop('tagName') === 'TR') {\n        const cell = valTemplate.children().last();\n        cell.css('position', 'relative').append(btnGroup);\n      } else {\n        valTemplate.css('position', 'relative');\n        valTemplate.append(btnGroup);\n      }\n    }\n    return valTemplate;\n  });\n}\n\n/**\n * Validate individual property values against property specification\n * @param {IndividualModel} individual - individual to validate\n * @param {string} property_uri - property which values are validated\n * @param {IndividualModel} spec - Property specification to validate values against\n * @return {Object} - validation result\n */\nfunction validate (individual, property_uri, spec) {\n  let result = {\n    state: true,\n    cause: [],\n  };\n  if (!spec) {\n    return result;\n  }\n  const values = individual.get(property_uri);\n  // cardinality check\n  if (spec.hasValue('v-ui:minCardinality')) {\n    const minCardinalityState = (values.length >= spec['v-ui:minCardinality'][0] &&\n    // filter empty values\n    values.length === values.filter(function (item) {\n      return (\n        typeof item === 'boolean' ? true :\n          typeof item === 'number' ? true : !!item\n      );\n    }).length);\n    result.state = result.state && minCardinalityState;\n    if (!minCardinalityState) {\n      result.cause.push('v-ui:minCardinality');\n    }\n  }\n  if (spec.hasValue('v-ui:maxCardinality')) {\n    const maxCardinalityState = (\n      values.length <= spec['v-ui:maxCardinality'][0] &&\n      // filter empty values\n      values.length === values.filter(function (item) {\n        return (\n          typeof item === 'boolean' ? true :\n            typeof item === 'number' ? true : !!item\n        );\n      }).length\n    );\n    result.state = result.state && maxCardinalityState;\n    if (!maxCardinalityState) {\n      result.cause.push('v-ui:maxCardinality');\n    }\n  }\n  // check each value\n  result = result && values.reduce(function (result, value) {\n    // regexp check\n    if (spec.hasValue('v-ui:regexp')) {\n      const regexp = new RegExp(spec['v-ui:regexp'][0]);\n      const regexpState = regexp.test(value.toString());\n      result.state = result.state && regexpState;\n      if (!regexpState) {\n        result.cause.push('v-ui:regexp');\n      }\n    }\n    // range check\n    switch (spec['rdf:type'][0].id) {\n    case 'v-ui:DatatypePropertySpecification':\n      if (spec.hasValue('v-ui:minValue')) {\n        const minValueState = (value >= spec['v-ui:minValue'][0]);\n        result.state = result.state && minValueState;\n        if (!minValueState) {\n          result.cause.push('v-ui:minValue');\n        }\n      }\n      if (spec.hasValue('v-ui:maxValue')) {\n        const maxValueState = (value <= spec['v-ui:maxValue'][0]);\n        result.state = result.state && maxValueState;\n        if (!maxValueState) {\n          result.cause.push('v-ui:maxValue');\n        }\n      }\n      if (spec.hasValue('v-ui:minLength')) {\n        const minLengthState = (value.toString().length >= spec['v-ui:minLength'][0]);\n        result.state = result.state && minLengthState;\n        if (!minLengthState) {\n          result.cause.push('v-ui:minLength');\n        }\n      }\n      if (spec.hasValue('v-ui:maxLength')) {\n        const maxLengthState = (value.toString().length <= spec['v-ui:maxLength'][0]);\n        result.state = result.state && maxLengthState;\n        if (!maxLengthState) {\n          result.cause.push('v-ui:maxLength');\n        }\n      }\n      break;\n    case 'v-ui:ObjectPropertySpecification':\n      break;\n    }\n    return result;\n  }, result);\n  return result;\n}\n"],"file":"individual_presenter.js"}