{"version":3,"sources":["../../../source-web/js/browser/app_presenter.js"],"names":["AppPresenter","specialTemplateHandler","event","uri","getAttribute","hash","altKey","ctrlKey","preventDefault","stopPropagation","riot","route","delegateHandler","document","body","outlined","removeOutline","removeEventListener","outline","removeAttribute","classList","remove","add","setAttribute","addEventListener","veda","on","resourcesNodes","querySelectorAll","resources","Array","prototype","map","call","node","Util","unique","forEach","resource_uri","resource","IndividualModel","property_uri","properties","length","type","trigger","get","anchorHandler","window","location","routerInstalled","installRouter","main","loadIndicator","getElementById","style","display","hash_index","indexOf","substring","$","empty","present","then","tokens","decodeURI","slice","split","container","template","mode","extra","reduce","acc","pair","name","values","value","push","parse","individual","scroll","scrollTo","Number","isNaN","join","parseFloat","Date","isSync","isNew","starting","layout_uri","manifest","veda_layout","main_uri","veda_main","start_url","layout","load","catch","error","notify","Notify","console","log","layout_param_uri","user","hasValue","layout_param","main_param_uri","main_param"],"mappings":"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","sourcesContent":["// Application presenter\n\nimport './check_browser.js';\n\nimport veda from '../common/veda.js';\n\nimport riot from '../common/lib/riot.js';\n\nimport IndividualModel from '../common/individual_model.js';\n\nimport Notify from './notify.js';\n\nimport Util from '../common/util.js';\n\nimport {delegateHandler} from '../browser/dom_helpers.js';\n\nimport '../browser/notification_listener.js';\n\nimport '../browser/line_status_listener.js';\n\n/**\n * Application presenter\n */\nexport default function AppPresenter () {\n  /**\n   * Render individual under mouse pointer with special system template v-ui:ttl\n   * when Left mouse button with Ctrl + Alt keys are pressed\n   * @param {Event} event\n   * @this Element\n   */\n  function specialTemplateHandler (event) {\n    const uri = this.getAttribute('resource') || this.getAttribute('about');\n    const hash = `#/${uri}`;\n    if (event.altKey && event.ctrlKey) {\n      event.preventDefault();\n      event.stopPropagation();\n      riot.route(`${hash}//v-ui:ttl`);\n    }\n  }\n  delegateHandler(document.body, 'click', '[resource], [about]', specialTemplateHandler, true);\n\n  // Outline resource containers to switch view to special templates\n  let outlined;\n\n  /**\n   * Unset title and remove outline from individual under mouse pointer\n   * @param {Event} event\n   */\n  function removeOutline (event) {\n    document.body.removeEventListener('mouseover', outline);\n    if (outlined) {\n      outlined.removeAttribute('title');\n      outlined.classList.remove('gray-outline');\n    }\n    outlined = null;\n  }\n\n  /**\n   * Set title = individual id and add outline for individual under mouse pointer\n   * when Left mouse button with Ctrl + Alt keys are pressed\n   * @param {Event} event\n   * @this Element\n   */\n  function outline (event) {\n    if (event.altKey && event.ctrlKey) {\n      event.stopPropagation();\n      if (outlined) {\n        outlined.classList.remove('gray-outline');\n        outlined.removeAttribute('title');\n      }\n      this.classList.add('gray-outline');\n      this.setAttribute('title', this.getAttribute('resource') || this.getAttribute('about'));\n      outlined = this;\n    } else {\n      removeOutline(event);\n    }\n  }\n\n  document.body.addEventListener('keydown', (event) => {\n    if (event.altKey && event.ctrlKey) {\n      delegateHandler(document.body, 'mouseover', '[resource], [about]', outline);\n    }\n  });\n  document.body.addEventListener('keyup', removeOutline);\n\n  /**\n   * Localize resources on the page on language change\n   */\n  veda.on('language:changed', () => {\n    const resourcesNodes = document.querySelectorAll('[resource], [about]');\n    let resources = Array.prototype.map.call(resourcesNodes, (node) => node.getAttribute('about') || node.getAttribute('resource'));\n    resources = Util.unique(resources);\n    resources.forEach((resource_uri) => {\n      const resource = new IndividualModel(resource_uri);\n      for (const property_uri in resource.properties) {\n        if (property_uri === '@') {\n          continue;\n        }\n        if (resource.properties[property_uri] && resource.properties[property_uri].length && resource.properties[property_uri][0].type === 'String') {\n          resource.trigger('propertyModified', property_uri, resource.get(property_uri));\n          resource.trigger(property_uri, resource.get(property_uri));\n        }\n      }\n    });\n  });\n\n  /**\n   * Call router when anchor link is clicked\n   * @param {Event} event\n   * @this {Element}\n   * @return {void}\n   */\n  function anchorHandler (event) {\n    event.preventDefault();\n    const hash = this.getAttribute('href');\n    return (hash === window.location.hash ? false : riot.route(hash));\n  }\n  delegateHandler(document.body, 'click', '[href^=\\'#/\\']', anchorHandler);\n\n  // Prevent empty links routing\n  delegateHandler(document.body, 'click', '[href=\\'\\']', (event) => event.preventDefault());\n\n  // Router already installed flag\n  let routerInstalled;\n\n  /**\n   * Install router\n   * @param {Individual} main - Default individual to route if no hash is present\n   * @return {void}\n   */\n  function installRouter (main) {\n    if (routerInstalled) {\n      return;\n    }\n\n    routerInstalled = true;\n\n    // Router function\n    riot.route((hash) => {\n      const loadIndicator = document.getElementById('load-indicator');\n      loadIndicator.style.display = '';\n\n      if (typeof hash === 'string') {\n        const hash_index = hash.indexOf('#');\n        if (hash_index >= 0) {\n          hash = hash.substring(hash_index);\n        } else {\n          $('#main').empty();\n          return main.present('#main').then(() => loadIndicator.style.display = 'none');\n        }\n      } else {\n        $('#main').empty();\n        return main.present('#main').then(() => loadIndicator.style.display = 'none');\n      }\n      const tokens = decodeURI(hash).slice(2).split('/');\n      const uri = tokens[0];\n      const container = tokens[1] || '#main';\n      const template = tokens[2];\n      const mode = tokens[3];\n      let extra = tokens[4];\n      if (extra) {\n        extra = extra.split('&').reduce((acc, pair) => {\n          const split = pair.split('=');\n          const name = split[0] || '';\n          const values = split[1].split('|') || '';\n          acc[name] = acc[name] || [];\n          values.forEach((value) => acc[name].push(parse(value)));\n          return acc;\n        }, {});\n      }\n\n      if (uri) {\n        const individual = new IndividualModel(uri);\n        $(container).empty();\n        individual.present(container, template, mode, extra).then(() => {\n          loadIndicator.style.display = 'none';\n          if (!individual.scroll) {\n            window.scrollTo(0, 0);\n          }\n        });\n      } else {\n        $('#main').empty();\n        main.present('#main').then(() => loadIndicator.style.display = 'none');\n      }\n    });\n  }\n\n  /**\n   * Parse extra params in hash\n   * @param {string} value\n   * @return {Individual|Date|string|number|null}\n   */\n  function parse (value) {\n    if (!Number.isNaN(value.split(' ').join('').split(',').join('.'))) {\n      return parseFloat(value.split(' ').join('').split(',').join('.'));\n    } if (!Number.isNaN(Date.parse(value))) {\n      return new Date(value);\n    } if (value === 'true') {\n      return true;\n    } if (value === 'false') {\n      return false;\n    }\n    const individual = new IndividualModel(value);\n    if (individual.isSync() && !individual.isNew()) {\n      return individual;\n    }\n\n    return value || null;\n  }\n\n\n  let starting = false;\n\n  // Triggered in auth\n  veda.on('started', () => {\n    if (starting === true) return;\n    starting = true;\n\n    const loadIndicator = document.getElementById('load-indicator');\n    loadIndicator.style.display = '';\n\n    const layout_uri = veda.manifest.veda_layout;\n    const main_uri = veda.manifest.veda_main;\n    const {start_url} = veda.manifest;\n    $('#app').empty();\n    if (layout_uri && main_uri && start_url) {\n      const layout = new IndividualModel(layout_uri);\n      layout.present('#app')\n        .then(() => new IndividualModel(main_uri).load())\n        .then(installRouter)\n        .catch((error) => {\n          const notify = new Notify();\n          notify('danger', error);\n        })\n        .then(() => riot.route(window.location.hash || start_url))\n        .then(() => starting = false);\n    } else {\n      console.log('Incomplete layout params in manifest');\n      const layout_param_uri = veda.user.hasValue('v-s:origin', 'ExternalUser') ? 'cfg:LayoutExternal' : 'cfg:Layout';\n      const layout_param = new IndividualModel(layout_param_uri);\n      const main_param_uri = veda.user.hasValue('v-s:origin', 'ExternalUser') ? 'cfg:MainExternal' : 'cfg:Main';\n      const main_param = new IndividualModel(main_param_uri);\n      layout_param.load()\n        .then((layout_param) => layout_param['rdf:value'][0].load())\n        .then((layout) => layout.present('#app'))\n        .then(() => main_param.load())\n        .then((main_param) => main_param['rdf:value'][0].load())\n        .then(installRouter)\n        .catch((error) => {\n          const notify = new Notify();\n          notify('danger', error);\n        })\n        .then(() => riot.route(window.location.hash))\n        .then(() => starting = false);\n    }\n  });\n}\n"],"file":"app_presenter.js"}