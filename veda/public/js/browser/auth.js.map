{"version":3,"sources":["../../../source-web/js/browser/auth.js"],"names":["Auth","submitLoginPassword","event","preventDefault","passwordInput","loginForm","querySelector","login","value","password","hash","Sha256","ntlmProvider","IndividualModel","load","then","ntlm","hasValue","get","Promise","resolve","reject","xhr","XMLHttpRequest","open","setRequestHeader","responseType","onload","status","response","Error","onerror","onabort","send","error","console","log","Backend","authenticate","handleLoginSuccess","handleLoginError","reCAPTCHA","onSuccess","onExpired","onError","captchaRendered","reCAPTCHA_key","window","captchaCallback","grecaptcha","render","toString","captchaScript","document","createElement","src","head","appendChild","reset","enterLoginPassword","style","display","enterNewPassword","invalidSecretWarning","emptyPasswordWarning","equalPasswordWarning","invalidPasswordWarning","frequentPassChangeWarning","passChangeNotAllowedWarning","secretExpiredWarning","passwordExpiredError","loginFailedError","authLockedError","passChangeLockedError","unavailableError","secretRequestInfo","alerts","querySelectorAll","Array","prototype","forEach","call","alert","inputs","input","ok","okHandler","item","code","removeEventListener","changePasswordPressed","addEventListener","authResult","veda","trigger","setTicketCookie","ticket","expires","cookie","Date","parseInt","toGMTString","location","protocol","delTicketCookie","storage","localStorage","getElementById","delegateHandler","e","key","passwords","type","submit","newPassword","confirmNewPassword","passwordStrength","passwordMustMatch","secret","enterSecret","reMatch","re","test","passwordsMatch","isSecret","removeAttribute","setAttribute","on","$","empty","user_uri","end_time","logout","iframe","classList","add","iframeDoc","contentWindow","textContent","err","domain","ticketDelay","now","ticketDelayHours","Math","floor","ticketDelayMinutes","setTimeout","init","body","reload","is_ticket_valid","valid","authRequired","authRequiredParam"],"mappings":"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","sourcesContent":["// Veda application authentication\n\n'use strict';\n\nimport veda from '../common/veda.js';\n\nimport Backend from '../common/backend.js';\n\nimport IndividualModel from '../common/individual_model.js';\n\nimport Sha256 from '../common/lib/sha256.js';\n\nimport $ from 'jquery';\n\nimport {delegateHandler} from '../browser/dom_helpers.js';\n\n/**\n * Authenticate user\n */\nexport default function Auth() {\n  const storage = window.localStorage;\n\n  // Login invitation\n  const loginForm = document.getElementById('login-form');\n\n  loginForm.querySelector('#submit-login-password').addEventListener('click', submitLoginPassword);\n\n  delegateHandler(loginForm, 'keyup', '#login, #password', function (e) {\n    if (e.key === 'Enter') {\n      submitLoginPassword(e);\n    }\n  });\n\n  delegateHandler(loginForm, 'click', '.show-password', function (e) {\n    const passwords = loginForm.querySelectorAll('.password');\n    passwords.forEach((input) => input.type = input.type === 'password' ? 'text' : 'password');\n  });\n\n  /**\n   * Submit credentials handler\n   * @param {Event} event\n   * @return {void}\n   */\n  function submitLoginPassword(event) {\n    event.preventDefault();\n    const passwordInput = loginForm.querySelector('#password');\n    const login = loginForm.querySelector('#login').value;\n    const password = passwordInput.value;\n    const hash = Sha256.hash(password);\n\n    passwordInput.value = '';\n\n    const ntlmProvider = new IndividualModel('cfg:NTLMAuthProvider', true, false);\n    return ntlmProvider.load()\n      .then(function (ntlmProvider) {\n        const ntlm = !ntlmProvider.hasValue('v-s:deleted', true) && ntlmProvider.hasValue('rdf:value') && ntlmProvider.get('rdf:value')[0];\n        if (ntlm) {\n          return new Promise(function (resolve, reject) {\n            const xhr = new XMLHttpRequest();\n            xhr.open('POST', '/ad', true);\n            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');\n            xhr.responseType = 'json';\n            xhr.onload = function() {\n              if (xhr.status === 200) {\n                resolve(xhr.response);\n              } else {\n                reject(Error('AD form auth failed'));\n              }\n            };\n            xhr.onerror = reject;\n            xhr.onabort = reject;\n            xhr.send(`login=${login}&password=${password}`);\n          });\n        } else {\n          return Promise.reject(Error('AD provider is not defined'));\n        }\n      })\n      .catch(function (error) {\n        console.log(error);\n        return Backend.authenticate(login, hash);\n      })\n      .then(handleLoginSuccess)\n      .catch(handleLoginError);\n  }\n\n  delegateHandler(loginForm, 'input', '#new-password, #confirm-new-password, #secret', validateNewPassword);\n\n  const re = new RegExp('^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{6,})');\n\n  /**\n   * Validate new password\n   * @param {Event} event\n   * @return {void}\n   */\n  function validateNewPassword() {\n    const submit = loginForm.querySelector('#submit-new-password');\n    const newPassword = loginForm.querySelector('#new-password');\n    const confirmNewPassword = loginForm.querySelector('#confirm-new-password');\n    const passwordStrength = loginForm.querySelector('.password-strength');\n    const passwordMustMatch = loginForm.querySelector('.password-must-match');\n    const secret = loginForm.querySelector('#secret');\n    const enterSecret = loginForm.querySelector('.enter-secret');\n\n    const reMatch = re.test( newPassword.value );\n    const passwordsMatch = confirmNewPassword.value === newPassword.value;\n    const isSecret = !!secret.value;\n    const isValid = reMatch && passwordsMatch && isSecret;\n\n    if ( !reMatch ) {\n      passwordStrength.style.display = 'block';\n    } else {\n      passwordStrength.style.display = 'none';\n    }\n    if ( !passwordsMatch ) {\n      passwordMustMatch.style.display = 'block';\n    } else {\n      passwordMustMatch.style.display = 'none';\n    }\n    if ( !isSecret ) {\n      enterSecret.style.display = 'block';\n    } else {\n      enterSecret.style.display = 'none';\n    }\n    if ( !isValid ) {\n      submit.setAttribute('disabled', 'disabled');\n    } else {\n      submit.removeAttribute('disabled');\n    }\n  }\n\n  loginForm.querySelector('#submit-new-password').addEventListener('click', function (e) {\n    e.preventDefault();\n    const login = loginForm.querySelector('#login').value;\n    const password = loginForm.querySelector('#new-password').value;\n    const secret = loginForm.querySelector('#secret').value;\n    const hash = Sha256.hash(password);\n\n    Backend.authenticate(login, hash, secret)\n      .then(handleLoginSuccess)\n      .catch(handleLoginError)\n      .then(function () {\n        loginForm.querySelector('#new-password').value = '';\n        loginForm.querySelector('#confirm-new-password').value = '';\n      });\n  });\n\n  let changePasswordPressed;\n  loginForm.querySelector('#change-password').addEventListener('click', function (e) {\n    e.preventDefault();\n    changePasswordPressed = true;\n    const login = loginForm.querySelector('#login').value;\n    const secret = '?';\n\n    Backend.authenticate(login, undefined, secret)\n      .then(handleLoginSuccess)\n      .catch(handleLoginError);\n  });\n\n  // CAPTCHA already rendered flag\n  let captchaRendered = false;\n\n  /**\n   * Initialize CAPTCHA\n   * @param {Function} onSuccess\n   * @param {Function} onExpired\n   * @param {Function} onError\n   * @return {void}\n   */\n  function reCAPTCHA(onSuccess, onExpired, onError) {\n    if (!captchaRendered) {\n      const reCAPTCHA_key = new IndividualModel('cfg:reCAPTCHA_client_key');\n      reCAPTCHA_key.load().then(function (reCAPTCHA_key) {\n        window.captchaCallback = function() {\n          grecaptcha.render('recaptcha', {\n            'sitekey': reCAPTCHA_key.get('rdf:value')[0].toString(),\n            'theme': 'light',\n            'callback': onSuccess,\n            'expired-callback': onExpired,\n            'error-callback': onError,\n          });\n          captchaRendered = true;\n        };\n        const captchaScript = document.createElement('script');\n        captchaScript.src = 'https://www.google.com/recaptcha/api.js?onload=captchaCallback&render=explicit';\n        document.head.appendChild(captchaScript);\n      });\n    } else {\n      grecaptcha.reset();\n    }\n  }\n\n  /**\n   * Login error handler\n   * @param {Error} error\n   * @return {void}\n   */\n  function handleLoginError(error) {\n    const enterLoginPassword = loginForm.querySelector('#enter-login-password');\n    enterLoginPassword.style.display = 'none';\n    const enterNewPassword = loginForm.querySelector('#enter-new-password');\n    enterNewPassword.style.display = 'none';\n\n    const invalidSecretWarning = loginForm.querySelector('#invalid-secret-warning');\n    const emptyPasswordWarning = loginForm.querySelector('#empty-password-warning');\n    const equalPasswordWarning = loginForm.querySelector('#equal-password-warning');\n    const invalidPasswordWarning = loginForm.querySelector('#invalid-password-warning');\n    const frequentPassChangeWarning = loginForm.querySelector('#frequent-pass-change-warning');\n    const passChangeNotAllowedWarning = loginForm.querySelector('#pass-change-not-allowed-warning');\n    const secretExpiredWarning = loginForm.querySelector('#secret-expired-warning');\n\n    const passwordExpiredError = loginForm.querySelector('#password-expired-error');\n    const loginFailedError = loginForm.querySelector('#login-failed-error');\n    const authLockedError = loginForm.querySelector('#auth-locked-error');\n    const passChangeLockedError = loginForm.querySelector('#pass-change-locked-error');\n    const unavailableError = loginForm.querySelector('#unavailable-error');\n\n    const secretRequestInfo = loginForm.querySelector('#secret-request-info');\n\n    const alerts = loginForm.querySelectorAll('.alert');\n    Array.prototype.forEach.call(alerts, (alert) => alert.style.display = 'none');\n\n    const inputs = loginForm.querySelectorAll('input:not(#login)');\n    Array.prototype.forEach.call(inputs, (input) => input.value = '');\n\n    const ok = loginForm.querySelector('.btn.ok');\n    ok.style.display = 'none';\n    let okHandler = () => {};\n\n    const onSuccess = function () {\n      Array.prototype.forEach.call(loginForm.querySelectorAll('.alert, fieldset'), (item) => item.style.display = 'none');\n      enterLoginPassword.style.display = 'block';\n    };\n    const onExpired = function () {\n      Array.prototype.forEach.call(loginForm.querySelectorAll('.alert, fieldset'), (item) => item.style.display = 'none');\n      loginFailedError.style.display = 'block';\n    };\n\n    switch (error.code) {\n    case 423: // Password change is allowed once a day\n      frequentPassChangeWarning.style.display = 'block';\n      ok.style.display = 'block';\n      okHandler = function () {\n        frequentPassChangeWarning.style.display = 'none';\n        enterLoginPassword.style.display = 'block';\n        ok.removeEventListener('click', okHandler);\n        ok.style.display = 'none';\n      };\n      break;\n    case 429: // Too many auth fails\n      authLockedError.style.display = 'block';\n      ok.style.display = 'block';\n      okHandler = function () {\n        authLockedError.style.display = 'none';\n        enterLoginPassword.style.display = 'block';\n        ok.removeEventListener('click', okHandler);\n        ok.style.display = 'none';\n      };\n      break;\n    case 430: // Too many pass change fails\n      passChangeLockedError.style.display = 'block';\n      ok.style.display = 'block';\n      okHandler = function () {\n        passChangeLockedError.style.display = 'none';\n        enterLoginPassword.style.display = 'block';\n        ok.removeEventListener('click', okHandler);\n        ok.style.display = 'none';\n      };\n      break;\n    case 463: // Password change not allowed\n      passChangeNotAllowedWarning.style.display = 'block';\n      ok.style.display = 'block';\n      okHandler = function () {\n        passChangeNotAllowedWarning.style.display = 'none';\n        enterLoginPassword.style.display = 'block';\n        ok.removeEventListener('click', okHandler);\n        ok.style.display = 'none';\n      };\n      break;\n    case 464: // Secret expired\n      secretExpiredWarning.style.display = 'block';\n      ok.style.display = 'block';\n      okHandler = function () {\n        secretExpiredWarning.style.display = 'none';\n        enterLoginPassword.style.display = 'block';\n        ok.removeEventListener('click', okHandler);\n        ok.style.display = 'none';\n      };\n      break;\n    case 465: // Empty password\n      emptyPasswordWarning.style.display = 'block';\n      ok.style.display = 'block';\n      okHandler = function () {\n        emptyPasswordWarning.style.display = 'none';\n        enterLoginPassword.style.display = 'block';\n        ok.removeEventListener('click', okHandler);\n        ok.style.display = 'none';\n      };\n      break;\n    case 466: // New password is equal to old\n      equalPasswordWarning.style.display = 'block';\n      ok.style.display = 'block';\n      okHandler = function () {\n        equalPasswordWarning.style.display = 'none';\n        enterLoginPassword.style.display = 'block';\n        ok.removeEventListener('click', okHandler);\n        ok.style.display = 'none';\n      };\n      break;\n    case 467: // Invalid password\n      invalidPasswordWarning.style.display = 'block';\n      ok.style.display = 'block';\n      okHandler = function () {\n        invalidPasswordWarning.style.display = 'none';\n        enterLoginPassword.style.display = 'block';\n        ok.removeEventListener('click', okHandler);\n        ok.style.display = 'none';\n      };\n      break;\n    case 468: // Invalid secret\n      invalidSecretWarning.style.display = 'block';\n      ok.style.display = 'block';\n      okHandler = function () {\n        invalidSecretWarning.style.display = 'none';\n        enterLoginPassword.style.display = 'block';\n        ok.removeEventListener('click', okHandler);\n        ok.style.display = 'none';\n      };\n      break;\n    case 469: // Password expired\n      if ( !changePasswordPressed ) {\n        passwordExpiredError.style.display = 'block';\n        secretRequestInfo.style.display = 'block';\n        ok.style.display = 'block';\n        okHandler = function () {\n          passwordExpiredError.style.display = 'none';\n          enterNewPassword.style.display = 'block';\n          ok.removeEventListener('click', okHandler);\n          ok.style.display = 'none';\n        };\n      } else {\n        enterNewPassword.style.display = 'block';\n        secretRequestInfo.style.display = 'block';\n      }\n      break;\n    case 472: // Not authorized\n    case 473: // Authentication failed\n      loginFailedError.style.display = 'block';\n      enterLoginPassword.style.display = 'none';\n      reCAPTCHA(onSuccess, undefined, onSuccess);\n      break;\n    default:\n      unavailableError.style.display = 'block';\n      ok.style.display = 'block';\n      okHandler = function () {\n        unavailableError.style.display = 'none';\n        enterLoginPassword.style.display = 'block';\n        ok.removeEventListener('click', okHandler);\n        ok.style.display = 'none';\n      };\n      break;\n    }\n    ok.addEventListener('click', okHandler);\n  }\n\n  /**\n   * Login success handler\n   * @param {Object} authResult\n   * @return {void}\n   */\n  function handleLoginSuccess(authResult) {\n    const enterLoginPassword = loginForm.querySelector('#enter-login-password');\n\n    const alerts = loginForm.querySelectorAll('.alert');\n    Array.prototype.forEach.call(alerts, (alert) => alert.style.display = 'none');\n\n    const inputs = loginForm.querySelectorAll('input:not(#login)');\n    Array.prototype.forEach.call(inputs, (input) => input.value = '');\n\n    const ok = loginForm.querySelector('.btn.ok');\n    ok.style.display = 'none';\n\n    enterLoginPassword.style.display = 'block';\n\n    veda.trigger('login:success', authResult);\n  }\n\n  /**\n   * Set ticket cookie\n   * @param {string} ticket\n   * @param {number} expires\n   * @return {void}\n   */\n  function setTicketCookie(ticket, expires) {\n    const cookie = 'ticket=' + ticket + '; expires=' + new Date(parseInt(expires)).toGMTString() + '; samesite=strict; path=/;' + (window.location.protocol === 'https:' ? 'secure;' : '');\n    document.cookie = cookie;\n  }\n\n  /**\n   * Delete ticket cookie\n   * @return {void}\n   */\n  function delTicketCookie() {\n    setTicketCookie(null, 0);\n  }\n\n  veda.on('login:failed', function () {\n    $('#app').empty();\n    delete storage.ticket;\n    delete storage.user_uri;\n    delete storage.end_time;\n    delTicketCookie();\n\n    if (storage.logout) {\n      loginForm.style.display = 'block';\n      delete storage.logout;\n      return;\n    }\n\n    // NTLM auth using iframe\n    const ntlmProvider = new IndividualModel('cfg:NTLMAuthProvider', true, false);\n    ntlmProvider.load().then(function (ntlmProvider) {\n      const ntlm = !ntlmProvider.hasValue('v-s:deleted', true) && ntlmProvider.hasValue('rdf:value') && ntlmProvider.get('rdf:value')[0];\n      if (ntlm) {\n        const iframe = document.createElement('iframe');\n        iframe.classList.add('hidden');\n        loginForm.appendChild(iframe);\n        iframe.addEventListener('load', function () {\n          try {\n            loginForm.style.display = 'none';\n            const iframeDoc = iframe.contentWindow.document;\n            const ticket = iframeDoc.getElementById('ticket').textContent;\n            const user_uri = iframeDoc.getElementById('user_uri').textContent;\n            const end_time = iframeDoc.getElementById('end_time').textContent;\n            const authResult = {\n              ticket: ticket,\n              user_uri: user_uri,\n              end_time: end_time,\n            };\n            if (ticket && user_uri && end_time) {\n              veda.trigger('login:success', authResult);\n            } else {\n              throw Error('auto ntlm auth failed');\n            }\n          } catch (err) {\n            console.log(err);\n            loginForm.style.display = 'block';\n          }\n        });\n        document.domain = document.domain;\n        iframe.setAttribute('src', ntlm);\n      } else {\n        loginForm.style.display = 'block';\n      }\n    });\n  });\n\n  // Initialize application if ticket is valid\n  veda.on('login:success', function (authResult) {\n    loginForm.style.display = 'none';\n    veda.user_uri = storage.user_uri = authResult.user_uri;\n    veda.ticket = storage.ticket = authResult.ticket;\n    veda.end_time = storage.end_time = authResult.end_time;\n    setTicketCookie(veda.ticket, veda.end_time);\n    // Re-login on ticket expiration\n    if ( veda.end_time ) {\n      const ticketDelay = parseInt(veda.end_time) - Date.now();\n      const ticketDelayHours = Math.floor(ticketDelay / 1000 / 60 / 60);\n      const ticketDelayMinutes = Math.floor(ticketDelay / 1000 / 60 - ticketDelayHours * 60);\n      console.log('Ticket will expire in %d hrs. %d mins.', ticketDelayHours, ticketDelayMinutes);\n      setTimeout(function () {\n        console.log('Ticket expired, re-login.');\n        veda.trigger('login:failed');\n      }, ticketDelay);\n    }\n\n    document.getElementById('load-indicator').style.display = 'block';\n    veda.init(veda.user_uri).then(function () {\n      document.getElementById('load-indicator').style.display = 'none';\n      veda.trigger('started');\n    });\n  });\n\n  // Logout handler\n  delegateHandler(document.body, 'click', '#logout, .logout', function () {\n    delete storage.ticket;\n    delete storage.user_uri;\n    delete storage.end_time;\n    delTicketCookie();\n    storage.logout = true;\n    window.location.reload();\n  });\n\n  // Init application\n  document.getElementById('load-indicator').style.display = 'block';\n  veda.init('cfg:Guest')\n    .then(function () {\n      // Check if ticket is valid\n      const ticket = storage.ticket;\n      const user_uri = storage.user_uri;\n      const end_time = ( new Date() < new Date(parseInt(storage.end_time)) ) && storage.end_time;\n      if (ticket && user_uri && end_time) {\n        return Backend.is_ticket_valid(ticket);\n      } else {\n        return false;\n      }\n    })\n    .then(function (valid) {\n      if (valid) {\n        veda.trigger('login:success', {\n          ticket: storage.ticket,\n          user_uri: storage.user_uri,\n          end_time: storage.end_time,\n        });\n      } else {\n        const authRequired = new IndividualModel('cfg:AuthRequired');\n        authRequired.load().then(function (authRequiredParam) {\n          if ( authRequiredParam && authRequiredParam.hasValue('rdf:value', false) ) {\n            veda.trigger('login:success', {\n              ticket: '',\n              user_uri: 'cfg:Guest',\n              end_time: 0,\n            });\n          } else {\n            veda.trigger('login:failed');\n          }\n        });\n      }\n    })\n    .then(function () {\n      document.getElementById('load-indicator').style.display = 'none';\n    });\n}\n"],"file":"auth.js"}