"use strict";System.register(["../common/veda.js","../common/individual_model.js"],function(a){"use strict";/**
 * Application user
 * @param {string} uri
 * @return {UserModel}
 */function b(a){return d.call(this,a)}var c,d,e;return{setters:[function(a){c=a.default},function(a){d=a.default}],execute:function(){a("default",c.UserModel=b);b.prototype=Object.create(d.prototype),b.prototype.constructor=b,e=b.prototype,e.getLanguage=function(){return this.preferences&&this.preferences.language?Object.keys(this.preferences.language):void 0},e._init=function(){var a=this;return this.load().then(this.initAspect.bind(this)).then(this.initAppointment.bind(this)).then(this.initPreferences.bind(this)).then(this.initLanguage.bind(this)).then(function(){if("cfg:Guest"!==a.id)return a.save()})["catch"](function(a){console.log("User init error",a.stack)})},e.initAspect=function(){var a=this;if(this.hasValue("v-s:hasAspect"))return this.aspect=this["v-s:hasAspect"][0],this.aspect.load();var b=this.id+"_aspect";return new d(b).load().then(function(c){return c.hasValue("rdf:type","rdfs:Resource")?(a.aspect=new d(b),a.aspect["rdf:type"]=[new d("v-s:PersonalAspect")],a.aspect["v-s:owner"]=[a],a.aspect["rdfs:label"]=["PersonalAspect_"+a.id],a["v-s:hasAspect"]=[a.aspect],"cfg:Guest"!==a.id)?a.aspect.save():void 0:(a.aspect=c,a["v-s:hasAspect"]=[a.aspect],a.aspect)})},e.initAppointment=function(){var a=this;if(this.hasValue("v-s:defaultAppointment"))c.appointment=this["v-s:defaultAppointment"][0];else if(this.hasValue("v-s:hasAppointment"))this["v-s:defaultAppointment"]=[this["v-s:hasAppointment"][0]],c.appointment=this["v-s:defaultAppointment"][0];else return c.appointment=void 0;return this.on("v-s:defaultAppointment",function setAppointment(){var b=a.hasValue("v-s:defaultAppointment")&&a["v-s:defaultAppointment"][0];b&&b.load().then(function(a){c.appointment=a}),a.save()}),c.appointment.load()},e.initPreferences=function(){if(this.hasValue("v-ui:hasPreferences"))return this.preferences=this["v-ui:hasPreferences"][0],this.preferences.load();var a=this.id+"_pref";return this.preferences=new d(a),this.preferences["v-s:owner"]=[this],this.preferences["rdf:type"]=[new d("v-ui:Preferences")],this.preferences["rdfs:label"]=["Preferences_"+this.id],this["v-ui:hasPreferences"]=[this.preferences],this.preferences},e.initLanguage=function(a){var b=this,e=function(){a.language=a["v-ui:preferredLanguage"].reduce(function(a,b){return a[b.id.substr(b.id.indexOf(":")+1)]=b,a},{}),c.trigger("language:changed")},f=function(){a.displayedElements=a["v-ui:displayedElements"][0]||10},g=function(){if("cfg:Guest"!==b.id)return a.save()};if(!a.hasValue("v-ui:preferredLanguage")||!a.hasValue("v-ui:displayedElements")){var h=new d("v-ui:RU");a["v-ui:preferredLanguage"]=[h],a["v-ui:displayedElements"]=[10]}return a.on("v-ui:preferredLanguage",e),a.on("v-ui:displayedElements",f),a.on("v-ui:preferredLanguage v-ui:displayedElements",g),e(),f(),g()}}}});
//# sourceMappingURL=user_model.js.map