"use strict";System.register(["../common/veda.js","../common/individual_model.js","../common/backend.js","../common/util.js"],function(a){"use strict";/**
 * Ontology
 * @return {OntologyModel}
 */function b(){// Singleton pattern
return b.prototype._singletonInstance?b.prototype._singletonInstance:(this.ontology=[],this.ontologies={},this.datatypes={},this.classes={},this.properties={},this.specifications={},this.models={},this.classTree={},this.templates={},b.prototype._singletonInstance=this.init())}var c,d,e,f,g;return{setters:[function(a){c=a.default},function(a){d=a.default},function(a){e=a.default},function(a){f=a.default}],execute:function(){a("default",c.OntologyModel=b);g=b.prototype,g.init=function(){var a=this;return"undefined"==typeof window?e.query(c.ticket,"'rdf:type' == 'owl:Ontology' || 'rdf:type' == 'rdfs:Class' || 'rdf:type' == 'rdf:Property' || 'rdf:type' == 'rdfs:Datatype' || 'rdf:type' == 'v-ui:PropertySpecification' || 'rdf:type' == 'v-ui:ClassModel'").then(function(a){var b=a.result;return e.get_individuals(c.ticket,b)}).then(function(b){return a.ontology=b,console.log("Ontology length:",b.length),a.processOntology()}):e.loadFile("/ontology.json").then(function(b){return a.ontology=JSON.parse(b),a.processOntology()})["catch"](function(a){throw console.log("Ontology load error.",a.stack),a})},g.getClassProperties=function(a){var b=this.classTree,c=function(a){var d,e=b[a];return e?(d=e.properties,[].concat.apply(d,e.superClasses.map(c))):c("rdfs:Resource")};return f.unique(c(a))},g.getClassSpecifications=function(a){var b=this.classTree,c=function(a){var d,e=b[a];if(e){d=e.specifications;var f=e.superClasses.map(c);f.map(function(a){for(var b in a)d[b]||(d[b]=a[b])})}else d=c("rdfs:Resource");return d};return c(a)},g.getClassTemplate=function(a){var b=this.templates[a];return b?b[0]:null},g.processOntology=function(){var a=this,b=this.ontology,c=this.ontologies,e=this.datatypes,f=this.classes,g=this.properties,h=this.specifications,i=this.classTree,j=this.models,k=this.templates,l=b.map(function(a){return"{\"@\":\"\"}"===JSON.stringify(a)?void 0:new d(a,1,!1)});l.forEach(function(a){try{if(!a)return;var b=a.properties["rdf:type"][0].data,i=a.id;switch(b){case"rdfs:Class":case"owl:Class":f[i]=a;break;case"rdf:Property":case"owl:DatatypeProperty":case"owl:ObjectProperty":case"owl:OntologyProperty":case"owl:AnnotationProperty":g[i]=a,d.prototype.hasOwnProperty(i)||d.defineProperty(i);break;case"v-ui:PropertySpecification":case"v-ui:DatatypePropertySpecification":case"v-ui:ObjectPropertySpecification":h[i]=a;break;case"owl:Ontology":c[i]=a;break;case"rdfs:Datatype":e[i]=a;break;case"v-ui:ClassModel":j[i]=a;break;case"v-ui:TemplateSpecification":var l=a.properties["v-ui:forClass"][0].data;k[l]?k[l].push(a):k[l]=[a];}}catch(b){console.log("Ontology init error, uri =",a.id,b.stack)}}),Object.keys(f).forEach(function(a){try{var b=f[a];// populate classTree
// rdfs:Resource is a top level class
if(i[b.id]||(i[b.id]={superClasses:[],properties:[],specifications:{}}),"rdfs:Resource"===b.id)return;// If class is not a subclass of another then make it a subclass of rdfs:Resource
b.hasValue("rdfs:subClassOf")||(b["rdfs:subClassOf"]=[f["rdfs:Resource"]]),b["rdfs:subClassOf"].map(function(a){i[b.id].superClasses.push(a.id)})}catch(b){console.log("Ontology init error, uri =",a,b.stack)}}),Object.keys(g).forEach(function(a){try{var b=g[a];if(!b["rdfs:domain"])return;b["rdfs:domain"].map(function(a){i[a.id].properties.push(b.id)})}catch(b){console.log("Ontology init error, uri =",a,b.stack)}}),Object.keys(h).forEach(function(a){try{var b=h[a];if(!b["v-ui:forClass"])return;b["v-ui:forClass"].map(function(a){b["v-ui:forProperty"].map(function(c){i[a.id].specifications[c.id]=b.id})})}catch(b){console.log("Ontology init error, uri =",a,b.stack)}}),Object.keys(k).forEach(function(a){try{k[a]=k[a].sort(function(a,b){return a.properties["v-s:loadPriority"]?b.properties["v-s:loadPriority"]?a.properties["v-s:loadPriority"][0].data-b.properties["v-s:loadPriority"][0].data:-1:1}).map(function(a){return a.properties["v-ui:defaultTemplate"][0].data})}catch(b){console.log("Ontology init error, uri =",a,b.stack)}});// Init ontology individuals
var m=l.map(function(a){return a.init()["catch"](function(b){return console.log("Ontology individual init error, uri =",a.id,b.stack)})});return"undefined"==typeof window?Promise.resolve(this):Promise.all(m).then(function(){return a})}}}});
//# sourceMappingURL=ontology_model.js.map