{"version":3,"sources":["../../../source-web/js/common/individual_model.js"],"names":["IndividualModel","uri","cache","init","_","isNew","isSync","isLoaded","pending","properties","original","JSON","stringify","cached","id","veda","get","Util","genUri","set","riot","observable","on","beforeSaveHandler","now","Date","user","appointment","hasValue","unique","arr","val","n","r","i","length","type","data","lang","push","parser","value","string","String","language","parse","parseFloat","parseInt","serializer","isInteger","toISOString","split","reg_uri","test","valueOf","reg_date","reg_ml_string","replace","toUpperCase","addSingleValue","property_uri","serialized","removeSingleValue","filter","item","toggleSingleValue","call","prefetch","result","depth","uris","allowed_props","toGet","indexOf","Backend","get_individuals","ticket","Promise","resolve","then","got","nextUris","forEach","json","individual","Object","keys","key","map","apply","concat","proto","prototype","values","silently","Array","isArray","Boolean","uniq","trigger","defineProperty","configurable","enumerable","previous","remove","membership","get_membership","membershipJSON","catch","error","console","log","memberOf","group_item","isMemberOf","group_uri","rights","get_rights","rightsJSON","can","action","charAt","slice","toLowerCase","canCreate","canRead","canUpdate","canDelete","get_rights_origin","rightsOriginArr","rightsOrigin","all","load","isLoading","window","status","reset","is","isUserThing","loadingPromise","get_individual","individualJson","stack","code","one","save","isAtomic","isSaving","reduce","acc","delta","diff","promise","put_individual","added","add_to_individual","differ","set_in_individual","missing","remove_from_individual","forced","mergeServerState","server_state","missing_object_values","addValue","isResetting","reset_individual","delete","remove_individual","recover","found","removeValue","toggleValue","clearValue","empty","_class","isSub","types","results","state","isClass","model","modelFn","Function","types_promises","type_promise","models_promises","models","clone","cloneProperties","isPending","operation","toJson","toString","formatValue","join","getPropertyChain","args","shift","getChainValue","individuals","promises","children","hasChainValue","sought_value"],"mappings":"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","sourcesContent":["// Class to manipulate individuals.\n\n'use strict';\n\nimport veda from '../common/veda.js';\n\nimport riot from '../common/lib/riot.js';\n\nimport Backend from '../common/backend.js';\n\nimport Util from '../common/util.js';\n\nexport default veda.IndividualModel = IndividualModel;\n\n/**\n * @constructor\n * @param {string} uri URI of individual. If not specified, than id of individual will be generated automatically.\n * @param {boolean} cache Use cache true / false. If true or not set, then object will be return from application cache (veda.cache). If false or individual not found in application cache - than individual will be loaded from database\n * @param {boolean} init individual with class model at load. If true or not set, then individual will be initialized with class specific model upon load.\n */\nfunction IndividualModel (uri, cache, init) {\n  // IndividualModel({...})\n  if (typeof uri === 'object' && !uri['@']) {\n    cache = uri.cache;\n    init = uri.init;\n    uri = uri.uri;\n  }\n\n  // Define Model data\n  this._ = {\n    cache: typeof cache === 'boolean' ? cache : cache || true,\n    init: typeof init !== 'undefined' ? init : true,\n    isNew: typeof uri === 'undefined',\n    isSync: typeof uri === 'object',\n    isLoaded: typeof uri === 'object',\n    pending: {},\n    uri: uri,\n  };\n\n  if (typeof uri === 'object') {\n    this.properties = uri;\n    this.original = JSON.stringify(uri);\n  } else {\n    this.properties = {};\n  }\n\n  if (this._.cache) {\n    let cached;\n    if (typeof uri === 'string') {\n      this.id = uri;\n      cached = veda.cache.get(this.id);\n    } else if (typeof uri === 'object') {\n      cached = veda.cache.get(this.id);\n      if (cached && !cached.isLoaded()) {\n        cached.properties = uri;\n      }\n    } else if (typeof uri === 'undefined') {\n      this.id = Util.genUri();\n    }\n    if (cached) {\n      return cached;\n    } else {\n      veda.cache.set(this, this._.cache);\n    }\n  }\n\n  riot.observable(this);\n\n  this.on('rdf:type', this.init);\n  this.on('beforeSave', beforeSaveHandler);\n\n  return this;\n};\n\n/**\n * Save handler. Sets creator & creation date\n * @this IndividualModel\n */\nfunction beforeSaveHandler () {\n  const now = new Date();\n  const user = veda.appointment ? veda.appointment : veda.user;\n\n  if ( !this.hasValue('v-s:creator') ) {\n    this.set('v-s:creator', [user]);\n  }\n  if ( !this.hasValue('v-s:created') ) {\n    this.set('v-s:created', [now]);\n  }\n\n  if (veda.user.id === 'cfg:Administrator') {\n    return;\n  } else if (\n    !this.hasValue('v-s:lastEditor') ||\n    !this.hasValue('v-s:edited') ||\n    this.get('v-s:lastEditor')[0].id !== user.id ||\n    (now - this.get('v-s:edited')[0]) > 1000\n  ) {\n    this.set('v-s:edited', [now]);\n    this.set('v-s:lastEditor', [user]);\n  }\n}\n\nconst proto = IndividualModel.prototype;\n\nproto.get = function (property_uri) {\n  if (!this.properties[property_uri]) return [];\n  return this.properties[property_uri].map(parser).filter((i) => typeof i !== 'undefined');\n};\n\nproto.set = function (property_uri, values, silently) {\n  this.isSync(false);\n  if ( !Array.isArray(values) ) {\n    values = [values];\n  }\n  const serialized = values.map(serializer).filter(Boolean);\n  const uniq = unique(serialized);\n  if ( JSON.stringify(uniq) !== JSON.stringify(this.properties[property_uri] || []) ) {\n    if (uniq.length) {\n      this.properties[property_uri] = uniq;\n    } else {\n      delete this.properties[property_uri];\n    }\n    if ( !silently ) {\n      values = this.get(property_uri);\n      return this.trigger('propertyModified', property_uri, values)\n        .then(() => this.trigger(property_uri, values));\n    }\n  }\n  return Promise.resolve(this);\n};\n\n/**\n * Utility fn\n * @param {Array} arr\n * @return {Array}\n */\nfunction unique (arr) {\n  const n = {}; const r = [];\n  for (let i = 0, val; i < arr.length; i++) {\n    val = arr[i].type + arr[i].data + (arr[i].lang || '');\n    if (!n[val]) {\n      n[val] = true;\n      r.push(arr[i]);\n    }\n  }\n  return r;\n}\n\n// Define properties from ontology in IndividualModel.prototype\nIndividualModel.defineProperty = function (property_uri) {\n  Object.defineProperty(proto, property_uri, {\n    get: function () {\n      return this.get(property_uri);\n    },\n    set: function (values) {\n      return this.set(property_uri, values);\n    },\n    configurable: false,\n    enumerable: false,\n  });\n};\n\n/**\n * Parse serialized value\n * @param {Object} value\n * @return {string|number|Date|Boolean}\n */\nfunction parser (value) {\n  if (value.type === 'String' && value.data) {\n    const string = new String(value.data);\n    if (value.lang && value.lang !== 'NONE') {\n      string.language = value.lang;\n    }\n    return string;\n  } else if (value.type === 'Uri') {\n    return new IndividualModel(value.data);\n  } else if (value.type === 'Datetime') {\n    return new Date(Date.parse(value.data));\n  } else if (value.type === 'Decimal') {\n    return parseFloat(value.data);\n  } else if (value.type === 'Integer') {\n    return parseInt(value.data);\n  } else if (value.type === 'Boolean') {\n    return Boolean(value.data);\n  }\n}\n\nconst reg_uri = /^[a-z][a-z-0-9]*:([a-zA-Z0-9-_])*$/;\nconst reg_date = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z$/;\nconst reg_ml_string = /^(.*)@(en|ru)$/ims;\n\n/**\n * Serialize value\n * @param {number|Boolean|Date|string|IndividualModel} value\n * @return {Object}\n */\nfunction serializer (value) {\n  if (typeof value === 'number' ) {\n    return {\n      type: Util.isInteger(value) ? 'Integer' : 'Decimal',\n      data: value,\n    };\n  } else if (typeof value === 'boolean') {\n    return {\n      type: 'Boolean',\n      data: value,\n    };\n  } else if (value instanceof Date) {\n    return {\n      type: 'Datetime',\n      data: value.toISOString().split('.')[0]+'Z',\n    };\n  } else if (value instanceof IndividualModel) {\n    return {\n      type: 'Uri',\n      data: value.id,\n    };\n  } else if (typeof value === 'string' || value instanceof String) {\n    if ( reg_uri.test(value) ) {\n      return {\n        type: 'Uri',\n        data: value.valueOf(),\n      };\n    } else if ( reg_date.test(value) ) {\n      return {\n        type: 'Datetime',\n        data: value.valueOf(),\n      };\n    } else if ( reg_ml_string.test(value) ) {\n      return {\n        type: 'String',\n        data: value.replace(reg_ml_string, '$1'),\n        lang: value.replace(reg_ml_string, '$2').toUpperCase(),\n      };\n    } else if (value.length) {\n      return {\n        type: 'String',\n        data: value.valueOf(),\n        lang: value.language || 'NONE',\n      };\n    }\n  }\n}\n\n// Special properties\nObject.defineProperty(proto, 'id', {\n  get: function () {\n    return this.properties['@'];\n  },\n  set: function (value) {\n    const previous = this.properties && this.properties['@'];\n    this.properties['@'] = value;\n    if (previous && this._.cache && veda.cache.get(previous)) {\n      veda.cache.remove(previous);\n      veda.cache.set(this, this._.cache);\n    }\n  },\n});\n\nObject.defineProperty(proto, 'membership', {\n  get: function () {\n    // if (this._.membership) { return Promise.resolve(this._.membership); }\n    if (this.isNew()) {\n      this._.membership = new IndividualModel({cache: false});\n      return Promise.resolve(this._.membership);\n    }\n    return Backend.get_membership(veda.ticket, this.id)\n      .then((membershipJSON) => {\n        return this._.membership = new IndividualModel({uri: membershipJSON, cache: false});\n      })\n      .catch((error) => {\n        console.log('membership error', this.id, error);\n        return this._.membership = new IndividualModel({cache: false});\n      });\n  },\n  configurable: false,\n  enumerable: false,\n});\n\nproto.memberOf = function () {\n  return this.membership.then((membership) => {\n    return membership.hasValue('v-s:memberOf') ? membership.properties['v-s:memberOf'].map((group_item) => group_item.data) : [];\n  });\n};\n\nproto.isMemberOf = function (group_uri) {\n  return this.membership.then((membership) => membership.hasValue('v-s:memberOf', group_uri));\n};\n\nObject.defineProperty(proto, 'rights', {\n  get: function () {\n    // if (this._.rights) { return Promise.resolve(this._.rights); }\n    if (this.isNew()) {\n      this._.rights = new IndividualModel({cache: false});\n      this._.rights['v-s:canCreate'] = [true];\n      this._.rights['v-s:canRead'] = [true];\n      this._.rights['v-s:canUpdate'] = [true];\n      this._.rights['v-s:canDelete'] = [true];\n      return Promise.resolve(this._.rights);\n    }\n    return Backend.get_rights(veda.ticket, this.id).then((rightsJSON) => {\n      return this._.rights = new IndividualModel(rightsJSON, false);\n    }).catch((error) => {\n      console.log('rights error', this.id, error);\n      return this._.rights = new IndividualModel({cache: false});\n    });\n  },\n  configurable: false,\n  enumerable: false,\n});\n\nproto.can = function (action) {\n  action = action.charAt(0).toUpperCase() + action.slice(1).toLowerCase();\n  return this.rights.then((rights) => rights.hasValue('v-s:can' + action, true));\n};\nproto.canCreate = function () {\n  return this.can('Create');\n};\nproto.canRead = function () {\n  return this.can('Read');\n};\nproto.canUpdate = function () {\n  return this.can('Update');\n};\nproto.canDelete = function () {\n  return this.can('Delete');\n};\n\nObject.defineProperty(proto, 'rightsOrigin', {\n  get: function () {\n    // if (this._.rightsOrigin) { return Promise.resolve(this._.rightsOrigin); }\n    return Backend.get_rights_origin(veda.ticket, this.id).then((rightsOriginArr) => {\n      return this._.rightsOrigin = Promise.all(rightsOriginArr.map((item) => {\n        return new IndividualModel(item, false);\n      }));\n    }).catch((error) => {\n      console.log('rights error', this.id, error);\n      return this._.rightsOrigin = [];\n    });\n  },\n  configurable: false,\n  enumerable: false,\n});\n\n/**\n * Load individual specified by uri from database. If cache parameter (from constructor) is true, than try to load individual from browser cache first.\n * @return {Promise<IndividualModel>}\n */\nproto.load = function () {\n  if ( this.isLoading() && typeof window !== 'undefined' ) {\n    return this.isLoading();\n  }\n  return this.trigger('beforeLoad').then(() => {\n    if ( this.isLoaded() && ( Backend.status === 'online' || Backend.status === 'offline' ) ) {\n      return this.trigger('afterLoad');\n    } else if ( this.isLoaded() && Backend.status === 'limited' ) {\n      if (typeof window !== 'undefined') {\n        return this.is('v-s:UserThing').then((isUserThing) => {\n          if (isUserThing) {\n            return this.reset();\n          } else {\n            return this;\n          }\n        }).then(() => {\n          return this.trigger('afterLoad');\n        });\n      } else {\n        return this.reset()\n          .then(() => {\n            return this.trigger('afterLoad');\n          });\n      }\n    }\n    const uri = this._.uri;\n    if (typeof uri === 'string') {\n      const loadingPromise = Backend.get_individual(veda.ticket, uri).then((individualJson) => {\n        this.isLoading(false);\n        this.isNew(false);\n        this.isSync(true);\n        this.isLoaded(true);\n        this.properties = individualJson;\n        this.original = JSON.stringify(individualJson);\n        return (this._.init ? this.init() : Promise.resolve(this))\n          .then(() => this.trigger('afterLoad'));\n      }).catch((error) => {\n        this.isLoading(false);\n        console.log('load individual error', this.id, error.stack);\n        if (error.code === 422 || error.code === 404) {\n          this.isNew(true);\n          this.isSync(false);\n          this.isLoaded(false);\n          this.properties = {\n            '@': uri,\n            'rdf:type': [{type: 'Uri', data: 'rdfs:Resource'}],\n            'rdfs:label': [\n              {type: 'String', data: 'Объект не существует [' + uri + ']', lang: 'RU'},\n              {type: 'String', data: 'Object does not exist [' + uri + ']', lang: 'EN'},\n            ],\n          };\n        } else if (error.code === 472) {\n          this.isNew(false);\n          this.isSync(false);\n          this.isLoaded(false);\n          this.properties = {\n            '@': uri,\n            'rdf:type': [{type: 'Uri', data: 'rdfs:Resource'}],\n            'rdfs:label': [\n              {type: 'String', data: 'Нет прав на объект', lang: 'RU'},\n              {type: 'String', data: 'Insufficient rights', lang: 'EN'},\n            ],\n          };\n        } else if (error.code === 470 || error.code === 471) {\n          this.isNew(false);\n          this.isSync(false);\n          this.isLoaded(false);\n        } else if (error.code === 0 || error.code === 4000 || error.code === 503) {\n          this.isNew(false);\n          this.isSync(false);\n          this.isLoaded(false);\n          this.properties = {\n            '@': uri,\n            'rdf:type': [{type: 'Uri', data: 'rdfs:Resource'}],\n            'rdfs:label': [\n              {type: 'String', data: 'Нет связи с сервером. Этот объект сейчас недоступен.', lang: 'RU'},\n              {type: 'String', data: 'Server disconnected. This object is not available now.', lang: 'EN'},\n            ],\n          };\n          veda.one('online', () => this.reset());\n        } else {\n          this.isNew(false);\n          this.isSync(false);\n          this.isLoaded(false);\n          this.properties = {\n            '@': uri,\n            'rdf:type': [{type: 'Uri', data: 'rdfs:Resource'}],\n            'rdfs:label': [{type: 'String', data: uri, lang: 'NONE'}],\n          };\n        }\n        return this.trigger('afterLoad');\n      });\n      return this.isLoading(loadingPromise);\n    } else if (typeof uri === 'object') {\n      this.isNew(false);\n      this.isSync(true);\n      this.isLoaded(true);\n      this.properties = uri;\n    } else if (typeof uri === 'undefined') {\n      this.isNew(true);\n      this.isSync(false);\n      this.isLoaded(false);\n    }\n    return (this._.init ? this.init() : Promise.resolve(this))\n      .then(() => this.trigger('afterLoad'));\n  });\n};\n\n/**\n * Save current individual to database\n * @param {boolean} isAtomic\n * @return {Promise<IndividualModel>}\n */\nproto.save = function (isAtomic) {\n  // Do not save individual to server if nothing changed\n  if (this.isSync()) {\n    return Promise.resolve(this);\n  }\n  if ( this.isSaving() && this.isSync() && typeof window !== 'undefined' ) {\n    return this.isSaving();\n  }\n  if (isAtomic == undefined) isAtomic = true;\n  return this.trigger('beforeSave').then(() => {\n    Object.keys(this.properties).reduce((acc, property_uri) => {\n      if (property_uri === '@') return acc;\n      if (!acc[property_uri].length) delete acc[property_uri];\n      return acc;\n    }, this.properties);\n\n    const original = this.original ? JSON.parse(this.original) : {'@': this.id};\n    const delta = Util.diff(this.properties, original);\n\n    const promise = (this.isNew() || isAtomic ?\n      Backend.put_individual(veda.ticket, this.properties) :\n      Promise.all([\n        delta.added && Object.keys(delta.added).length ? (delta.added['@'] = this.id, Backend.add_to_individual(veda.ticket, delta.added)) : undefined,\n        delta.differ && Object.keys(delta.differ).length ? (delta.differ['@'] = this.id, Backend.set_in_individual(veda.ticket, delta.differ)) : undefined,\n        delta.missing && Object.keys(delta.missing).length? (delta.missing['@'] = this.id, Backend.remove_from_individual(veda.ticket, delta.missing)) : undefined,\n      ])\n    ).then(() => {\n      this.original = JSON.stringify(this.properties);\n      this.isSaving(false);\n      this.isNew(false);\n      this.isSync(true);\n      this.isLoaded(true);\n      return this.trigger('afterSave');\n    }).catch((error) => {\n      this.isSaving(false);\n      console.log('save individual error', this.id, error);\n      throw error;\n    });\n    return this.isSaving(promise);\n  });\n};\n\n/**\n * Reset current individual to database\n * @param {Boolean} forced\n * @return {Promise<IndividualModel>}\n */\nproto.reset = function (forced) {\n  /**\n   * Merge original from DB with local changes\n   * @param {Object} original\n   * @return {void}\n   */\n  const mergeServerState = (server_state) => {\n    this.original = JSON.stringify(server_state);\n    const delta = Util.diff(this.properties, server_state);\n    if (forced || this.isSync() || !this.isLoaded()) {\n      this.properties = server_state;\n      this.isNew(false);\n      this.isSync(true);\n      this.isLoaded(true);\n      return Promise.all(Object.keys(delta.added).concat(Object.keys(delta.differ), Object.keys(delta.missing)).map((property_uri) => {\n        const values = this.get(property_uri);\n        return this.trigger('propertyModified', property_uri, values).then(() => this.trigger(property_uri, values));\n      }));\n    } else {\n      // Add missing properties\n      return Promise.all(Object.keys(delta.missing).map((property_uri) => {\n        return this.set(property_uri, server_state[property_uri].map(parser));\n      })).then(() => {\n        // Add missing object values\n        return Promise.all(Object.keys(delta.differ).map((property_uri) => {\n          const missing_object_values = server_state[property_uri].map(parser).filter((value) => !this.hasValue(property_uri, value) && value instanceof IndividualModel);\n          return this.addValue(property_uri, missing_object_values);\n        }));\n      });\n    }\n  };\n\n  if ( this.isResetting() && typeof window !== 'undefined' ) {\n    return this.isResetting();\n  }\n  return this.trigger('beforeReset').then(() => {\n    if (this.isNew()) {\n      return this.trigger('afterReset');\n    }\n    const promise = Backend.reset_individual(veda.ticket, this.id)\n      .then(mergeServerState)\n      .then(() => {\n        this.isResetting(false);\n        return this.trigger('afterReset');\n      })\n      .catch((error) => {\n        this.isResetting(false);\n        console.log('reset individual error', this.id, error.stack);\n        throw error;\n      });\n    return this.isResetting(promise);\n  });\n};\n\n/**\n * Mark current individual as deleted in database (set v-s:deleted = true)\n * @return {Promise<IndividualModel>}\n */\nproto.delete = function () {\n  return this.trigger('beforeDelete').then(() => {\n    if ( this.isNew() ) {\n      return;\n    }\n    this['v-s:deleted'] = [true];\n    this['rdf:type'] = this['rdf:type'].concat(new veda.IndividualModel('v-s:Deletable'));\n    return this.save();\n  }).then(() => this.trigger('afterDelete'));\n};\n\n/**\n * Remove individual from database\n * @return {Promise<IndividualModel>}\n */\nproto.remove = function () {\n  return this.trigger('beforeRemove').then(() => {\n    if ( this._.cache && veda.cache && veda.cache.get(this.id) ) {\n      veda.cache.remove(this.id);\n    }\n    if ( this.isNew() ) {\n      return;\n    }\n    return Backend.remove_individual(veda.ticket, this.id);\n  }).then(() => this.trigger('afterRemove'));\n};\n\n/**\n * Recover current individual in database (remove v-s:deleted property)\n * @return {Promise<IndividualModel>}\n */\nproto.recover = function () {\n  return this.trigger('beforeRecover').then(() => {\n    this['v-s:deleted'] = [false];\n    return this.save();\n  }).then(() => this.trigger('afterRecover'));\n};\n\n/**\n * Check if individual has a property and optionally check if it contains a value\n * @param {String} property_uri property name\n * @param {Object} value to check\n * @return {boolean} is requested property (and optionally value) exists in this individual\n */\nproto.hasValue = function (property_uri, value) {\n  if (!property_uri && typeof value !== 'undefined' && value !== null) {\n    let found = false;\n    for (const property_uri in this.properties) {\n      if (property_uri === '@') {\n        continue;\n      }\n      found = found || this.hasValue(property_uri, value);\n    }\n    return found;\n  }\n  let result = !!(this.properties[property_uri] && this.properties[property_uri].length);\n  if (typeof value !== 'undefined' && value !== null) {\n    const serialized = serializer(value);\n    result = result && !!this.properties[property_uri].filter( function (item) {\n      return ( item.type === serialized.type && item.data === serialized.data && (item.lang && serialized.lang ? item.lang === serialized.lang : true) );\n    }).length;\n  }\n  return result;\n};\n\n/**\n * Add value to individual\n * @param {String} property_uri property name\n * @param {Any_allowed_type} values\n * @param {Boolean} silently\n * @return {IndividualModel}\n */\nproto.addValue = function (property_uri, values, silently) {\n  if (typeof values === 'undefined' || values === null) {\n    return Promise.resolve(this);\n  }\n  this.properties[property_uri] = this.properties[property_uri] || [];\n  if ( Array.isArray(values) ) {\n    values.forEach((value) => addSingleValue.call(this, property_uri, value));\n  } else {\n    addSingleValue.call(this, property_uri, values);\n  }\n  this.isSync(false);\n  if ( !silently ) {\n    values = this.get(property_uri);\n    return this.trigger('propertyModified', property_uri, values)\n      .then(() => this.trigger(property_uri, values));\n  }\n  return Promise.resolve(this);\n};\n\n/**\n * Add value to individual\n * @param {String} property_uri property name\n * @param {Any_allowed_type} value\n * @return {void}\n * @this IndividualModel\n */\nfunction addSingleValue (property_uri, value) {\n  if (value != undefined) {\n    const serialized = serializer(value);\n    this.properties[property_uri].push(serialized);\n  }\n}\n\n/**\n * Remove value from individual\n * @param {String} property_uri property name\n * @param {Any_allowed_type} values\n * @param {Boolean} silently\n * @return {IndividualModel}\n */\nproto.removeValue = function (property_uri, values, silently) {\n  if (!this.properties[property_uri] || !this.properties[property_uri].length || typeof values === 'undefined' || values === null) {\n    return Promise.resolve(this);\n  }\n  if ( Array.isArray(values) ) {\n    values.forEach((value) => removeSingleValue.call(this, property_uri, value));\n  } else {\n    removeSingleValue.call(this, property_uri, values);\n  }\n  this.isSync(false);\n  if ( !silently ) {\n    values = this.get(property_uri);\n    return this.trigger('propertyModified', property_uri, values)\n      .then(() => this.trigger(property_uri, values));\n  }\n  return Promise.resolve(this);\n};\n\n/**\n * Remove value from individual\n * @param {String} property_uri property name\n * @param {Any_allowed_type} value\n * @this {IndividualModel}\n * @return {void}\n */\nfunction removeSingleValue (property_uri, value) {\n  if (value != undefined) {\n    const serialized = serializer(value);\n    this.properties[property_uri] = (this.properties[property_uri] || []).filter(function (item) {\n      return !( item.data == serialized.data && (item.lang && serialized.lang ? item.lang === serialized.lang : true) );\n    });\n  }\n}\n\n/**\n * Toggle value in individual\n * @param {String} property_uri\n * @param {Any_allowed_type} values\n * @param {Boolean} silently\n * @return {this}\n */\nproto.toggleValue = function (property_uri, values, silently) {\n  if (typeof values === 'undefined' || values === null) {\n    return Promise.resolve(this);\n  }\n  this.properties[property_uri] = this.properties[property_uri] || [];\n  if ( Array.isArray(values) ) {\n    values.forEach((value) => toggleSingleValue.call(this, property_uri, value));\n  } else {\n    toggleSingleValue.call(this, property_uri, values);\n  }\n  this.isSync(false);\n  if ( !silently ) {\n    values = this.get(property_uri);\n    return this.trigger('propertyModified', property_uri, values)\n      .then(() => this.trigger(property_uri, values));\n  }\n  return Promise.resolve(this);\n};\n\n/**\n * Toggle value in individual\n * @param {String} property_uri\n * @param {Any_allowed_type} value\n * @this IndividualModel\n */\nfunction toggleSingleValue (property_uri, value) {\n  if (value != undefined) {\n    if ( this.hasValue(property_uri, value) ) {\n      removeSingleValue.call(this, property_uri, value);\n    } else {\n      addSingleValue.call(this, property_uri, value);\n    }\n  }\n}\n\n/**\n * Clear property values in individual\n * @param {String} property_uri\n * @param {Boolean} silently\n * @return {this}\n */\nproto.clearValue = function (property_uri, silently) {\n  if (!this.properties[property_uri] || !this.properties[property_uri].length) {\n    return Promise.resolve(this);\n  } else {\n    delete this.properties[property_uri];\n    this.isSync(false);\n    if ( !silently ) {\n      const empty = [];\n      return this.trigger('propertyModified', property_uri, empty)\n        .then(() => this.trigger(property_uri, empty));\n    }\n  }\n  return Promise.resolve(this);\n};\n\n/**\n * Check if individual is an instace of specific class\n * @param {String} _class id of class to check\n * @return {boolean} is individual rdf:type subclass of requested class\n */\nproto.is = function (_class) {\n  const isSub = function (type) {\n    if (is) {\n      return is;\n    }\n    if (!type.hasValue('rdfs:subClassOf')) {\n      return (is = is || false);\n    } else if (type.hasValue('rdfs:subClassOf', _class.id)) {\n      return (is = is || true);\n    } else {\n      const types = type.get('rdfs:subClassOf');\n      return Promise.all(types.map(isSub)).then(function (results) {\n        return results.reduce((state, isSub) => state || isSub, false);\n      });\n    }\n  };\n\n  if (typeof _class.valueOf() === 'string') {\n    _class = new IndividualModel( _class.valueOf() );\n  }\n  const types = this.get('rdf:type');\n  let is = types.reduce((state, type) => state || this.hasValue('rdf:type', _class.id), false);\n  if (is) {\n    return Promise.resolve(is);\n  } else {\n    return Promise.all(types.map(isSub)).then((results) => {\n      return results.reduce((state, isSub) => state || isSub, false);\n    });\n  }\n};\n\n/**\n * Initialize individual with class specific domain properties and methods\n * @return {Promise<IndividualModel>}\n */\nproto.init = function () {\n  const isClass = this.hasValue('rdf:type', 'owl:Class') || this.hasValue('rdf:type', 'rdfs:Class');\n  if ( this.hasValue('v-ui:hasModel') && !isClass ) {\n    return this.get('v-ui:hasModel')[0].load()\n      .then((model) => {\n        if ( !model.modelFn ) {\n          model.modelFn = new Function('veda', model['v-s:script'][0]);\n        }\n        model.modelFn.call(this, veda);\n        return this;\n      });\n  } else {\n    const types_promises = this.get('rdf:type').map((type_promise) => {\n      return type_promise.load();\n    });\n    return Promise.all( types_promises )\n      .then((types) => {\n        const models_promises = [];\n        types.map((type) => {\n          if ( type.hasValue('v-ui:hasModel') ) {\n            models_promises.push( type.get('v-ui:hasModel')[0].load() );\n          }\n        });\n        return Promise.all( models_promises );\n      })\n      .then((models) => {\n        models.map((model) => {\n          if ( !model.modelFn ) {\n            model.modelFn = new Function('veda', model.get('v-s:script')[0]);\n          }\n          model.modelFn.call(this, veda);\n        });\n        return this;\n      });\n  }\n};\n\n/**\n * Clone individual with different (generated) id\n * @return {Promise<IndividualModel>} clone of this individual with different id.\n */\nproto.clone = function () {\n  const cloneProperties = JSON.parse( JSON.stringify(this.properties) );\n  cloneProperties['@'] = Util.genUri();\n  const clone = new IndividualModel(cloneProperties);\n  clone.isNew(true);\n  clone.isSync(false);\n  clone.clearValue('v-s:updateCounter');\n  return clone.init();\n};\n\n/**\n * Set/get flag whether individual is synchronized with db\n * @param {boolean} value\n * @return {boolean}\n */\nproto.isSync = function (value) {\n  return ( typeof value !== 'undefined' ? this._.isSync = value : this._.isSync );\n};\n\n/**\n * Set/get flag whether individual is new (not saved in db)\n * @param {boolean} value\n * @return {boolean}\n */\nproto.isNew = function (value) {\n  return ( typeof value !== 'undefined' ? this._.isNew = value : this._.isNew );\n};\n\n/**\n * Set/get flag whether individual was loaded from db\n * @param {boolean} value\n * @return {boolean}\n */\nproto.isLoaded = function (value) {\n  return ( typeof value !== 'undefined' ? this._.isLoaded = value : this._.isLoaded );\n};\n\nproto.isPending = function (operation, value) {\n  return ( typeof value !== 'undefined' ? this._.pending[operation] = value : this._.pending[operation] );\n};\n\nproto.isLoading = function (value) {\n  return this.isPending('load', value);\n};\nproto.isSaving = function (value) {\n  return this.isPending('save', value);\n};\nproto.isResetting = function (value) {\n  return this.isPending('reset', value);\n};\n\n/**\n * Serialize to JSON\n * @return {Object} JSON representation of individual.\n */\nproto.toJson = function () {\n  return this.properties;\n};\n\n/**\n * Serialize to string\n * @return {String} String representation of individual.\n */\nproto.toString = function () {\n  return this.hasValue('rdfs:label') ? this.get('rdfs:label').map(Util.formatValue).join(' ') : this.hasValue('rdf:type') ? this.get('rdf:type')[0].toString() + ': ' + this.id : this.id;\n};\n\n/**\n * Return this\n * @return {String} individual id.\n */\nproto.valueOf = function () {\n  return this.id;\n};\n\n/**\n * Get values for first property chain branch.\n * @return {Promise<Array>}\n */\nproto.getPropertyChain = function (...args) {\n  const property_uri = args.shift();\n  return this.load().then(() => {\n    if ( this.hasValue(property_uri) ) {\n      if ( !args.length ) {\n        return this[property_uri];\n      } else {\n        return this.getPropertyChain.apply(this[property_uri][0], args);\n      }\n    }\n    return [];\n  }).catch((error) => {\n    console.log(error);\n  });\n};\n\n/**\n * Get values for all property chain branches.\n * @return {Promise<Array>}\n */\nproto.getChainValue = function (...properties) {\n  let individuals = this;\n  if ( !Array.isArray(individuals) ) {\n    individuals = [individuals];\n  }\n  const property_uri = properties.shift();\n  const promises = individuals.map(function (individual) {\n    return individual.load();\n  });\n  return Promise.all(promises).then(function (individuals) {\n    const children = individuals.reduce(function (acc, individual) {\n      return acc.concat(individual[property_uri]);\n    }, []);\n    if ( !properties.length ) {\n      return children;\n    } else {\n      return proto.getChainValue.apply(children, properties);\n    }\n  }).catch(function (error) {\n    console.log(error);\n    return [];\n  });\n};\n\n/**\n * Check value for all property chain branches.\n * @param {string} sought_value\n * @param {...string} ...args\n * @return {Promise<Boolean>}\n */\nproto.hasChainValue = function (sought_value, ...args) {\n  return this.getChainValue(...args).then(function (values) {\n    return values.reduce(function (state, value) {\n      return state || sought_value.valueOf() == value.valueOf();\n    }, false);\n  });\n};\n\n/**\n * Prefetch linked objects. Useful for presenting objects with many links.\n * @param {number} depth of the object tree to prefetch.\n * @return {Promise}\n */\nproto.prefetch = function (depth, ...allowed_props) {\n  depth = depth || 1;\n  return this.load().then(() => {\n    return prefetch.apply(this, [[], depth, [this.id]].concat(allowed_props) );\n  });\n};\n\n/**\n * Prefetch linked objects. Useful for presenting objects with many links.\n * @param {Array} result\n * @param {number} depth of the object tree to prefetch\n * @param {Array} uris\n * @return {Promise}\n * @this IndividualModel\n */\nfunction prefetch (result, depth, uris, ...allowed_props) {\n  uris = Util.unique( uris );\n  const toGet = uris.filter((uri) => {\n    const cached = veda.cache.get(uri);\n    if ( cached && result.indexOf(cached) < 0 ) {\n      result.push(cached);\n    }\n    return !cached;\n  });\n  return (toGet.length ? Backend.get_individuals(veda.ticket, toGet) : Promise.resolve([])).then((got) => {\n    const nextUris = [];\n    got.forEach((json) => {\n      if (json) {\n        const individual = new IndividualModel(json);\n        if ( result.indexOf(individual) < 0 ) {\n          result.push(individual);\n        }\n      }\n    });\n    if (depth - 1 === 0) {\n      return result;\n    }\n    uris.forEach((uri) => {\n      const individual = new IndividualModel(uri);\n      const data = individual.properties;\n      Object.keys(data).forEach( function (key) {\n        if ( key === '@' || (allowed_props.length && allowed_props.indexOf(key) < 0) ) {\n          return;\n        }\n        data[key].map(function (value) {\n          if (value.type === 'Uri') {\n            nextUris.push(value.data);\n          }\n        });\n      });\n    });\n    if (!nextUris.length) {\n      return result;\n    }\n    return prefetch.apply(this, [result, depth-1, nextUris].concat(allowed_props) );\n  });\n}\n"],"file":"individual_model.js"}