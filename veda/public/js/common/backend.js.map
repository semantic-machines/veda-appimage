{"version":3,"sources":["../../../source-web/js/common/backend.js"],"names":["setStatus","state","status","line","ccus","browserBackend","trigger","BackendError","result","errorCodes","code","name","message","stack","Error","veda","check","call_server","params","method","url","data","ticket","timeout","default_timeout","queryParams","payload","Promise","resolve","reject","xhr","XMLHttpRequest","onload","JSON","parse","response","onerror","ontimeout","push","encodeURIComponent","join","open","setRequestHeader","stringify","send","call_server_put","enqueueCall","then","queue","console","log","length","localDB","LocalDB","db","get","put","flushQueue","is_ticket_valid","isValid","reduce","prom","error","remove","serverBackend","Backend","env","query","queryStr","sort","databases","top","limit","from","arg","isObj","err","get_individual","uri","json","reset_individual","get_individuals","uris","remove_individual","put_individual","individual","add_to_individual","set_in_individual","remove_from_individual","query_timeout","ping","on","duration","interval","clearInterval","setInterval","arguments","window","addEventListener","prototype","Object","create","constructor","get_rights","get_rights_origin","get_membership","authenticate","login","password","secret","id","user_uri","end_time","Math","floor","get_ticket_trusted","get_operation_state","module_id","wait_op_id","wait_module","in_op_id","op_id_from_module","i","endtime","Date","getTime","reopen","sql","results","get_from_server","p","results_from_server","j","promises","map","all","fulfilled","filter","Boolean","assigned_subsystems","event_id","transaction_id","put_individuals","individuals","forEach","uploadFile","tries","fail","file","path","progress","fd","FormData","upload","onprogress","done","onabort","append","File","Image","src","memoize","fn","cache","n","loadFile","queue_length"],"mappings":"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","sourcesContent":["'use strict';\n\nimport veda from '../common/veda.js';\n\nimport LocalDB from '../browser/local_db.js';\n\nconst serverBackend = {};\n\nconst browserBackend = {};\n\nexport default veda.Backend = ( veda.env === 'server' ? serverBackend : browserBackend );\n\n// ////////////   SERVER   ///////////////\n\nserverBackend.status = 'limited';\n\nserverBackend.query = function (ticket, queryStr, sort, databases, top, limit, from) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  if (isObj) {\n    ticket = arg.ticket;\n    queryStr = arg.query;\n    sort = arg.sort;\n    databases = arg.databases;\n    top = arg.top;\n    limit = arg.limit;\n    from = arg.from;\n  }\n  try {\n    return Promise.resolve( query(ticket, queryStr, sort, databases, top, limit, from) );\n  } catch (err) {\n    return Promise.reject(err);\n  }\n};\n\nserverBackend.get_individual = function (ticket, uri) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  if (isObj) {\n    ticket = arg.ticket;\n    uri = arg.uri;\n  }\n  try {\n    const json = get_individual(ticket, uri);\n    if (json) {\n      return Promise.resolve(json);\n    } else {\n      return Promise.reject(Error('Not found'));\n    }\n  } catch (err) {\n    return Promise.reject(err);\n  }\n};\n\nserverBackend.reset_individual = serverBackend.get_individual;\n\nserverBackend.get_individuals = function (ticket, uris) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  if (isObj) {\n    ticket = arg.ticket;\n    uris = arg.uris;\n  }\n  try {\n    return Promise.resolve( get_individuals(ticket, uris) );\n  } catch (err) {\n    return Promise.reject(err);\n  }\n};\n\nserverBackend.remove_individual = function (ticket, uri) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  if (isObj) {\n    ticket = arg.ticket;\n    uri = arg.uri;\n  }\n  try {\n    return Promise.resolve( remove_individual(ticket, uri) );\n  } catch (err) {\n    return Promise.reject(err);\n  }\n};\n\nserverBackend.put_individual = function (ticket, individual) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  if (isObj) {\n    ticket = arg.ticket;\n    individual = arg.individual;\n  }\n  try {\n    return Promise.resolve( put_individual(ticket, individual) );\n  } catch (err) {\n    return Promise.reject(err);\n  }\n};\n\nserverBackend.add_to_individual = function (ticket, individual) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  if (isObj) {\n    ticket = arg.ticket;\n    individual = arg.individual;\n  }\n  try {\n    return Promise.resolve( add_to_individual(ticket, individual) );\n  } catch (err) {\n    return Promise.reject(err);\n  }\n};\n\nserverBackend.set_in_individual = function (ticket, individual) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  if (isObj) {\n    ticket = arg.ticket;\n    individual = arg.individual;\n  }\n  try {\n    return Promise.resolve( set_in_individual(ticket, individual) );\n  } catch (err) {\n    return Promise.reject(err);\n  }\n};\n\nserverBackend.remove_from_individual = function (ticket, individual) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  if (isObj) {\n    ticket = arg.ticket;\n    individual = arg.individual;\n  }\n  try {\n    return Promise.resolve( remove_from_individual(ticket, individual) );\n  } catch (err) {\n    return Promise.reject(err);\n  }\n};\n\n// ////////////   BROWSER   //////////////\n\nconst default_timeout = 15000;\nconst query_timeout = default_timeout * 10;\n\n// Check server health\nbrowserBackend.ping = function () {\n  return new Promise(function (resolve, reject) {\n    const xhr = new XMLHttpRequest();\n    xhr.onload = function () {\n      if (this.status == 200) {\n        resolve(this);\n      } else {\n        reject(Error('ping failed'));\n      }\n    };\n    xhr.onerror = reject;\n    xhr.ontimeout = reject;\n    xhr.open('GET', '/ping');\n    xhr.setRequestHeader('Cache-Control', 'no-cache, no-store, must-revalidate');\n    xhr.timeout = default_timeout;\n    xhr.send();\n  });\n};\n\nbrowserBackend.status = 'offline';\nconst status = {};\n\n/**\n * Line status event handler\n * @param {string} state\n * @this AppModel\n */\nfunction setStatus (state) {\n  status.line = state === 'online' ? 1 : state === 'offline' ? 0 : status.line;\n  status.ccus = state === 'ccus-online' ? 1 : state === 'ccus-offline' ? 0 : status.ccus;\n  if (status.line && status.ccus) {\n    browserBackend.status = 'online';\n  } else if (status.line && !status.ccus) {\n    browserBackend.status = 'limited';\n  } else {\n    browserBackend.status = 'offline';\n  }\n  this.trigger('status', browserBackend.status);\n};\nveda.on('online offline ccus-online ccus-offline', setStatus);\n\nlet interval;\nconst duration = default_timeout;\nconst check = function () {\n  browserBackend.ping().then(function () {\n    interval = clearInterval(interval);\n    veda.trigger('online');\n  }).catch(function () {\n    veda.trigger('offline');\n  });\n};\n\nbrowserBackend.check = function () {\n  if (interval) {\n    return;\n  }\n  interval = setInterval(check, duration);\n  if (!arguments.length) {\n    check();\n  }\n};\nif (typeof window !== 'undefined') {\n  window.addEventListener('online', browserBackend.check);\n  window.addEventListener('offline', browserBackend.check);\n  veda.on('ccus-online', browserBackend.check);\n  veda.on('ccus-offline', browserBackend.check);\n}\n\n// Server errors\n\n/**\n * Server errors constructor\n * @param {Error} result\n */\nfunction BackendError (result) {\n  const errorCodes = {\n    0: 'Server unavailable',\n    200: 'Ok',\n    201: 'Created',\n    204: 'No content',\n    400: 'Bad request',\n    403: 'Forbidden',\n    404: 'Not found',\n    422: 'Unprocessable entity',\n    423: 'Locked',\n    429: 'Too many requests',\n    430: 'Too many password change fails',\n    463: 'Password change is not allowed',\n    464: 'Secret expired',\n    465: 'Empty password',\n    466: 'New password is equal to old',\n    467: 'Invalid password',\n    468: 'Invalid secret',\n    469: 'Password expired',\n    470: 'Ticket not found',\n    471: 'Ticket expired',\n    472: 'Not authorized',\n    473: 'Authentication failed',\n    474: 'Not ready',\n    475: 'Fail open transaction',\n    476: 'Fail commit',\n    477: 'Fail store',\n    500: 'Internal server error',\n    501: 'Not implemented',\n    503: 'Service unavailable',\n    904: 'Invalid identifier',\n    999: 'Database modified error',\n    1021: 'Disk full',\n    1022: 'Duplicate key',\n    1118: 'Size too large',\n    4000: 'Connect error',\n  };\n  this.code = result.status;\n  this.name = errorCodes[this.code];\n  this.status = result.status;\n  this.message = errorCodes[this.code];\n  this.stack = (new Error()).stack;\n  if (result.status === 0 || result.status === 503 || result.status === 4000) {\n    veda.trigger('offline');\n    browserBackend.check();\n  }\n  if (result.status === 470 || result.status === 471) {\n    veda.trigger('login:failed');\n  }\n}\nBackendError.prototype = Object.create(Error.prototype);\nBackendError.prototype.constructor = BackendError;\n\n/**\n * Common server call function\n * @param {Object} params\n * @return {Promise<Object>}\n */\nfunction call_server(params) {\n  const method = params.method;\n  const url = params.url;\n  const data = params.data;\n  const ticket = params.ticket;\n  const timeout = params.timeout || default_timeout;\n  let queryParams = [];\n  let payload = null;\n  return new Promise( function (resolve, reject) {\n    const xhr = new XMLHttpRequest();\n    xhr.onload = function () {\n      if (this.status == 200) {\n        resolve( JSON.parse(this.response) );\n      } else {\n        reject( new BackendError(this) );\n      }\n    };\n    xhr.onerror = function () {\n      reject( new BackendError(this) );\n    };\n    xhr.ontimeout = function () {\n      reject( new BackendError(this) );\n    };\n    if (ticket) {\n      queryParams.push('ticket=' + ticket);\n    }\n    if (method === 'GET') {\n      for (const name in data) {\n        if (typeof data[name] !== 'undefined') {\n          queryParams.push(name + '=' + encodeURIComponent(data[name]));\n        }\n      }\n      queryParams = queryParams.join('&');\n    }\n    xhr.open(method, url + '?' + queryParams, true);\n    xhr.setRequestHeader('Cache-Control', 'no-cache, no-store, must-revalidate');\n    xhr.timeout = timeout;\n    if (method !== 'GET') {\n      xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');\n      payload = JSON.stringify(data);\n    }\n    xhr.send(payload);\n  });\n}\n\nbrowserBackend.get_rights = function (ticket, uri) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'GET',\n    url: '/get_rights',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'uri': isObj ? arg.uri : uri,\n    },\n  };\n  return call_server(params).catch(function (BackendError) {\n    if (BackendError.code === 0 || BackendError.code === 503 || BackendError.code === 4000 ) {\n      return {\n        '@': '_',\n        'rdf:type': [{'data': 'v-s:PermissionStatement', 'type': 'Uri'}],\n        'v-s:canCreate': [{'data': true, 'type': 'Boolean'}],\n        'v-s:canDelete': [{'data': false, 'type': 'Boolean'}],\n        'v-s:canRead': [{'data': true, 'type': 'Boolean'}],\n        'v-s:canUpdate': [{'data': true, 'type': 'Boolean'}],\n      };\n    } else {\n      throw BackendError;\n    }\n  });\n};\n\nbrowserBackend.get_rights_origin = function (ticket, uri) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'GET',\n    url: '/get_rights_origin',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'uri': isObj ? arg.uri : uri,\n    },\n  };\n  return call_server(params).catch(function (BackendError) {\n    if (BackendError.code === 0 || BackendError.code === 503 || BackendError.code === 4000 ) {\n      return [];\n    } else {\n      throw BackendError;\n    }\n  });\n};\n\nbrowserBackend.get_membership = function (ticket, uri) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'GET',\n    url: '/get_membership',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'uri': isObj ? arg.uri : uri,\n    },\n  };\n  return call_server(params).catch(function (BackendError) {\n    if (BackendError.code === 0 || BackendError.code === 503 || BackendError.code === 4000 ) {\n      return {\n        '@': '_',\n        'rdf:type': [{'data': 'v-s:Membership', 'type': 'Uri'}],\n        'v-s:memberOf': [{'data': 'v-s:AllResourcesGroup', 'type': 'Uri'}],\n        'v-s:resource': [{'data': isObj ? arg.uri : uri, 'type': 'Uri'}],\n      };\n    } else {\n      throw BackendError;\n    }\n  });\n};\n\n\nbrowserBackend.authenticate = function (login, password, secret) {\n  if (login == 'VedaNTLMFilter') {\n    login = 'cfg:Guest';\n  }\n  const arg = login;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'GET',\n    url: '/authenticate',\n    timeout: default_timeout,\n    data: {\n      'login': isObj ? arg.login : login,\n      'password': isObj ? arg.password : password,\n      'secret': isObj ? arg.secret : secret,\n    },\n  };\n  return call_server(params)\n    .then(function (result) {\n      return {\n        ticket: result.id,\n        user_uri: result.user_uri,\n        end_time: Math.floor((result.end_time - 621355968000000000) / 10000),\n      };\n    });\n};\n\nbrowserBackend.get_ticket_trusted = function (ticket, login) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'GET',\n    url: '/get_ticket_trusted',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'login': isObj ? arg.login : login,\n    },\n  };\n  return call_server(params);\n};\n\nbrowserBackend.is_ticket_valid = function (ticket) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'GET',\n    url: '/is_ticket_valid',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {},\n  };\n  return call_server(params).catch(function (BackendError) {\n    if (BackendError.code === 0 || BackendError.code === 503 || BackendError.code === 4000 ) {\n      return true;\n    } else {\n      throw BackendError;\n    }\n  });\n};\n\nbrowserBackend.get_operation_state = function (module_id, wait_op_id) {\n  const arg = module_id;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'GET',\n    url: '/get_operation_state',\n    timeout: default_timeout,\n    data: {\n      'module_id': isObj ? arg.module_id : module_id,\n      'wait_op_id': isObj ? arg.wait_op_id : wait_op_id,\n    },\n  };\n  return call_server(params);\n};\n\nbrowserBackend.wait_module = function (module_id, in_op_id) {\n  let timeout = 1;\n  let op_id_from_module;\n  for (let i = 0; i < 100; i++) {\n    op_id_from_module = browserBackend.get_operation_state(module_id, in_op_id);\n    if (op_id_from_module >= in_op_id) {\n      break;\n    }\n    const endtime = new Date().getTime() + timeout;\n    while (new Date().getTime() < endtime);\n    timeout += 2;\n  }\n};\n\nbrowserBackend.query = function (ticket, queryStr, sort, databases, reopen, top, limit, from, sql) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'POST',\n    url: '/query',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: query_timeout,\n    data: {\n      'query': isObj ? arg.query : queryStr,\n      'sort': isObj ? arg.sort : sort,\n      'databases': isObj ? arg.databases : databases,\n      'reopen': isObj ? arg.reopen : reopen,\n      'top': isObj ? arg.top : top,\n      'limit': isObj ? arg.limit : limit,\n      'from': isObj ? arg.from : from,\n      'sql': isObj ? arg.sql : sql,\n    },\n  };\n  return call_server(params).catch(function (BackendError) {\n    if (BackendError.code === 999) {\n      return browserBackend.query(ticket, queryStr, sort, databases, reopen, top, limit, from, sql);\n    } else if (BackendError.code === 0 || BackendError.code === 503 || BackendError.code === 4000 ) {\n      params.ticket = undefined;\n      const localDB = new LocalDB();\n      return localDB.then(function (db) {\n        return db.get(JSON.stringify(params));\n      });\n    } else {\n      throw BackendError;\n    }\n  }).then(function (result) {\n    if (result) {\n      params.ticket = undefined;\n      const localDB = new LocalDB();\n      localDB.then(function (db) {\n        db.put(JSON.stringify(params), result);\n      });\n    } else {\n      result = {\n        'result': [],\n        'count': 0,\n        'estimated': 0,\n        'processed': 0,\n        'cursor': 0,\n        'result_code': 200,\n      };\n    }\n    return result;\n  });\n};\n\nbrowserBackend.get_individual = function (ticket, uri, reopen) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'GET',\n    url: '/get_individual',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'uri': isObj ? arg.uri : uri,\n      'reopen': (isObj ? arg.reopen : reopen) || false,\n    },\n  };\n  if (browserBackend.status === 'online' || browserBackend.status === 'offline') {\n    // Cache first\n    const localDB = new LocalDB();\n    return localDB.then(function (db) {\n      return db.get(params.data.uri);\n    }).then(function (result) {\n      return result || call_server(params)\n        .then(function (individual) {\n          const localDB = new LocalDB();\n          localDB.then(function (db) {\n            db.put(individual['@'], individual);\n          }).catch(console.log);\n          return individual;\n        });\n    });\n  } else {\n    // Fetch second\n    return browserBackend.reset_individual(ticket, uri, reopen);\n  }\n};\n\nbrowserBackend.reset_individual = function (ticket, uri, reopen) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'GET',\n    url: '/get_individual',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'uri': isObj ? arg.uri : uri,\n      'reopen': (isObj ? arg.reopen : reopen) || false,\n    },\n  };\n  // Fetch first\n  return call_server(params).then(function (individual) {\n    const localDB = new LocalDB();\n    localDB.then(function (db) {\n      db.put(individual['@'], individual);\n    });\n    return individual;\n  }).catch(function (BackendError) {\n    if (BackendError.code === 0 || BackendError.code === 503 || BackendError.code === 4000 ) {\n      // Cache second\n      const localDB = new LocalDB();\n      return localDB.then(function (db) {\n        return db.get(params.data.uri);\n      }).then(function (result) {\n        if (result) {\n          return result;\n        } else {\n          throw BackendError;\n        }\n      });\n    } else {\n      throw BackendError;\n    }\n  });\n};\n\nbrowserBackend.get_individuals = function (ticket, uris) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'POST',\n    url: '/get_individuals',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'uris': isObj ? arg.uris : uris,\n    },\n  };\n  if (browserBackend.status === 'online' || browserBackend.status === 'offline') {\n    // Cache first\n    const localDB = new LocalDB();\n    return localDB.then(function (db) {\n      const results = [];\n      const get_from_server = [];\n      return params.data.uris.reduce(function (p, uri, i) {\n        return p.then(function() {\n          return db.get(uri).then(function (result) {\n            if (typeof result !== 'undefined') {\n              results[i] = result;\n            } else {\n              get_from_server.push(uri);\n            }\n            return results;\n          }).catch(function () {\n            get_from_server.push(uri);\n            return results;\n          });\n        });\n      }, Promise.resolve(results))\n        .then(function (results) {\n          if (get_from_server.length) {\n            params.data.uris = get_from_server;\n            return call_server(params);\n          } else {\n            return [];\n          }\n        })\n        .then(function (results_from_server) {\n          for (let i = 0, j = 0, length = results_from_server.length; i < length; i++) {\n            while (results[j++]); // Fast forward to empty element\n            results[j-1] = results_from_server[i];\n            db.put(results_from_server[i]['@'], results_from_server[i]);\n          }\n          return results;\n        })\n        .catch(console.log);\n    });\n  } else {\n    // Fetch second\n    return call_server(params).then(function (results) {\n      const localDB = new LocalDB();\n      localDB.then(function (db) {\n        results.reduce(function (p, result) {\n          p.then(function () {\n            return db.put(result['@'], result);\n          });\n        }, Promise.resolve());\n      });\n      return results;\n    }).catch(function (BackendError) {\n      if (BackendError.code === 0 || BackendError.code === 503 || BackendError.code === 4000 ) {\n        // Cache fallback\n        const localDB = new LocalDB();\n        return localDB.then(function (db) {\n          const promises = params.data.uris.map(function (uri) {\n            return db.get(uri);\n          });\n          return Promise.all(promises).then(function (fulfilled) {\n            return fulfilled.filter(Boolean);\n          });\n        });\n      } else {\n        throw BackendError;\n      }\n    });\n  }\n};\n\n/**\n * Common server PUT call function\n * @param {Object} params\n * @return {Promise<Object>}\n */\nfunction call_server_put(params) {\n  return call_server(params).catch(function (BackendError) {\n    if (BackendError.code === 0 || BackendError.code === 503 || BackendError.code === 4000 ) {\n      return enqueueCall(params).then(function (queue) {\n        console.log('Offline operation added to queue, queue length = ', queue.length);\n        return {\n          'op_id': 0,\n          'result': 200,\n        };\n      });\n    } else {\n      throw BackendError;\n    }\n  });\n}\n\nbrowserBackend.remove_individual = function (ticket, uri, assigned_subsystems, event_id, transaction_id) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'PUT',\n    url: '/remove_individual',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'uri': isObj ? arg.uri : uri,\n      'assigned_subsystems': (isObj ? arg.assigned_subsystems : assigned_subsystems) || 0,\n      'prepare_events': true,\n      'event_id': (isObj ? arg.event_id : event_id) || '',\n      'transaction_id': (isObj ? arg.transaction_id : transaction_id) || '',\n    },\n  };\n  return call_server_put(params)\n    .then(function () {\n      const localDB = new LocalDB();\n      return localDB.then(function (db) {\n        return db.remove(params.data.uri);\n      });\n    });\n};\n\nbrowserBackend.put_individual = function (ticket, individual, assigned_subsystems, event_id, transaction_id) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'PUT',\n    url: '/put_individual',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'individual': isObj ? arg.individual : individual,\n      'assigned_subsystems': (isObj ? arg.assigned_subsystems : assigned_subsystems) || 0,\n      'prepare_events': true,\n      'event_id': (isObj ? arg.event_id : event_id) || '',\n      'transaction_id': (isObj ? arg.transaction_id : transaction_id) || '',\n    },\n  };\n  return call_server_put(params)\n    .then(function () {\n      const localDB = new LocalDB();\n      localDB.then(function (db) {\n        db.put(params.data.individual['@'], params.data.individual);\n      }).catch(console.log);\n    });\n};\n\nbrowserBackend.add_to_individual = function (ticket, individual, assigned_subsystems, event_id, transaction_id) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'PUT',\n    url: '/add_to_individual',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'individual': isObj ? arg.individual : individual,\n      'assigned_subsystems': (isObj ? arg.assigned_subsystems : assigned_subsystems) || 0,\n      'prepare_events': true,\n      'event_id': (isObj ? arg.event_id : event_id) || '',\n      'transaction_id': (isObj ? arg.transaction_id : transaction_id) || '',\n    },\n  };\n  return call_server_put(params);\n};\n\nbrowserBackend.set_in_individual = function (ticket, individual, assigned_subsystems, event_id, transaction_id) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'PUT',\n    url: '/set_in_individual',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'individual': isObj ? arg.individual : individual,\n      'assigned_subsystems': (isObj ? arg.assigned_subsystems : assigned_subsystems) || 0,\n      'prepare_events': true,\n      'event_id': (isObj ? arg.event_id : event_id) || '',\n      'transaction_id': (isObj ? arg.transaction_id : transaction_id) || '',\n    },\n  };\n  return call_server_put(params);\n};\n\nbrowserBackend.remove_from_individual = function (ticket, individual, assigned_subsystems, event_id, transaction_id) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'PUT',\n    url: '/remove_from_individual',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'individual': isObj ? arg.individual : individual,\n      'assigned_subsystems': (isObj ? arg.assigned_subsystems : assigned_subsystems) || 0,\n      'prepare_events': true,\n      'event_id': (isObj ? arg.event_id : event_id) || '',\n      'transaction_id': (isObj ? arg.transaction_id : transaction_id) || '',\n    },\n  };\n  return call_server_put(params);\n};\n\nbrowserBackend.put_individuals = function (ticket, individuals, assigned_subsystems, event_id, transaction_id) {\n  const arg = ticket;\n  const isObj = typeof arg === 'object';\n  const params = {\n    method: 'PUT',\n    url: '/put_individuals',\n    ticket: isObj ? arg.ticket : ticket,\n    timeout: default_timeout,\n    data: {\n      'individuals': isObj ? arg.individuals : individuals,\n      'assigned_subsystems': (isObj ? arg.assigned_subsystems : assigned_subsystems) || 0,\n      'prepare_events': true,\n      'event_id': (isObj ? arg.event_id : event_id) || '',\n      'transaction_id': (isObj ? arg.transaction_id : transaction_id) || '',\n    },\n  };\n  return call_server_put(params)\n    .then(function () {\n      const localDB = new LocalDB();\n      localDB.then(function (db) {\n        params.data.individuals.forEach(function (individual) {\n          db.put(individual['@'], individual);\n        });\n      }).catch(console.log);\n    });\n};\n\nbrowserBackend.uploadFile = function (params, tries) {\n  tries = typeof tries === 'number' ? tries : 5;\n  return new Promise(function (resolve, reject) {\n    const done = () => {\n      if (xhr.status === 200) {\n        resolve(params);\n      } else {\n        reject(Error('File upload error'));\n      }\n    };\n    const fail = () => {\n      reject(Error('File upload error'));\n    };\n    const file = params.file;\n    const path = params.path;\n    const uri = params.uri;\n    const progress = params.progress;\n    const url = '/files';\n    const xhr = new XMLHttpRequest();\n    const fd = new FormData();\n    xhr.open('POST', url, true);\n    xhr.timeout = 10 * 60 * 1000;\n    xhr.upload.onprogress = progress;\n    xhr.onload = done;\n    xhr.onerror = fail;\n    xhr.onabort = fail;\n    xhr.ontimeout = fail;\n    fd.append('path', path);\n    fd.append('uri', uri);\n    if (file instanceof File) {\n      fd.append('file', file);\n    } else if (file instanceof Image) {\n      fd.append('content', file.src);\n    }\n    xhr.send(fd);\n  }).catch(function (error) {\n    if (tries > 0) {\n      return browserBackend.uploadFile(params, --tries);\n    }\n    throw error;\n  });\n};\n\nconst memoize = (fn) => {\n  const cache = {};\n  return (...args) => {\n    const n = args[0];\n    if (n in cache) {\n      return cache[n];\n    } else {\n      const result = fn(n);\n      cache[n] = result;\n      return result;\n    }\n  };\n};\n\nbrowserBackend.loadFile = memoize(function (url) {\n  return new Promise(function (resolve, reject) {\n    const done = () => {\n      if (xhr.status === 200) {\n        resolve(xhr.response);\n      } else {\n        reject(Error('File load error'));\n      }\n    };\n    const fail = () => {\n      reject(Error('File load error'));\n    };\n    const xhr = new XMLHttpRequest();\n    xhr.open('GET', url, true);\n    xhr.timeout = 10 * 60 * 1000;\n    xhr.onload = done;\n    xhr.onerror = fail;\n    xhr.onabort = fail;\n    xhr.ontimeout = fail;\n    xhr.send();\n  });\n});\n\n// //////////////////////////////////////////////////////////////////////\n\n/**\n * Enqueue failed PUT request to Offline queue to execute later\n * @param {Object} params\n * @return {Promise}\n */\nfunction enqueueCall(params) {\n  if (typeof params === 'object') {\n    params.ticket = undefined;\n  }\n  const localDB = new LocalDB();\n  return localDB.then(function (db) {\n    return db.get('offline-queue').then(function(queue) {\n      queue = queue || [];\n      queue.push( JSON.stringify(params) );\n      return db.put('offline-queue', queue);\n    });\n  });\n}\n\n/**\n * Execute enqueued requests\n * @return {Promise}\n */\nfunction flushQueue() {\n  const localDB = new LocalDB();\n  return localDB.then(function (db) {\n    return db.get('offline-queue').then(function(queue) {\n      if (queue && queue.length) {\n        if (veda.ticket) {\n          return browserBackend.is_ticket_valid(veda.ticket).then(function (isValid) {\n            if (isValid) {\n              return queue.reduce(function (prom, params) {\n                return prom.then(function () {\n                  params = JSON.parse(params);\n                  params.ticket = veda.ticket;\n                  return call_server(params);\n                }).catch(function (error) {\n                  console.log('Offline queue operation failed:', params, error);\n                });\n              }, Promise.resolve()).then(function () {\n                db.remove('offline-queue');\n                return queue.length;\n              });\n            } else {\n              return Promise.reject(Error('Ticket is not valid, skip queue flushing.'));\n            }\n          });\n        } else {\n          return Promise.reject(Error('No ticket, skip queue flushing.'));\n        }\n      } else {\n        return 0;\n      }\n    });\n  });\n}\nveda.on('online started', function () {\n  if (browserBackend.status === 'online') {\n    console.log('Veda \\'online\\', flushing queue');\n    flushQueue().then(function (queue_length) {\n      console.log('Done, queue flushed', queue_length);\n    }).catch(console.log);\n  }\n});\n"],"file":"backend.js"}